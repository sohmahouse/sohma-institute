---
import PortalLayout from '../layouts/PortalLayout.astro'
---

<PortalLayout
  title="The Field — Sohma Institute"
  description="A distributed clinical intelligence network of credentialed practitioners running shared protocols, contributing outcome data, and conferencing on complex cases across divisional boundaries."
>
  <article class="network-page">

    <!-- STICKY BAR -->
    <div class="network-sticky-bar">
      <a href="#" class="sticky-bar-login"><svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right:6px;vertical-align:-1px;"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>Login to portal</a>
    </div>

    <!-- HERO -->
    <header class="network-hero">
      <canvas id="network-mesh-canvas" aria-hidden="true"></canvas>
      <div class="hero-inner">
        <div class="section-label">The Practitioner Network</div>
        <h1 class="hero-title">Distributed clinical intelligence.</h1>
        <p class="hero-lead">The Field isn't a professional association. It's not an alumni directory. It's an operational mesh — credentialed practitioners running shared protocols, feeding outcome data into a common registry, and conferencing on complex cases across divisional boundaries. Every member practises within a system that gets smarter because they participate.</p>
      </div>
    </header>

    <!-- NETWORK TIERS -->
    <section class="tiers-section" id="tiers">
      <div class="tier-band tier-affiliate">
        <div class="tier-band-accent"></div>
        <div class="tier-band-inner">
          <div class="tier-band-left">
            <span class="tier-level-label">Tier I</span>
            <h3 class="tier-name">Affiliate</h3>
            <a href="/education/foundation-certificate" class="tier-credential-link">
              <span class="tier-credential-tag">Foundation Certificate</span>
              <span class="tier-credential-suffix">holders</span>
            </a>
          </div>
          <div class="tier-band-right">
            <div class="tier-detail">
              <span class="tier-detail-label">Access</span>
              <p>Tier A validated protocols. Continuing education program. Peer case conferencing.</p>
            </div>
            <div class="tier-detail">
              <span class="tier-detail-label">Role in the Network</span>
              <p>The broadest layer. Affiliates integrate Institute protocols into existing practice, contribute outcome data to the registry, and participate in peer case conferencing.</p>
            </div>
            <button type="button" class="tier-cta-btn" data-tier="Tier I — Affiliate">Enquire about membership</button>
          </div>
        </div>
      </div>

      <div class="tier-band tier-associate">
        <div class="tier-band-accent"></div>
        <div class="tier-band-inner">
          <div class="tier-band-left">
            <span class="tier-level-label">Tier II</span>
            <h3 class="tier-name">Associate</h3>
            <a href="/education/advanced-diploma" class="tier-credential-link">
              <span class="tier-credential-tag">Advanced Diploma</span>
              <span class="tier-credential-suffix">holders</span>
            </a>
          </div>
          <div class="tier-band-right">
            <div class="tier-detail">
              <span class="tier-detail-label">Access</span>
              <p>Full protocol library including Tier B provisional protocols. Eligible to supervise Affiliates.</p>
            </div>
            <div class="tier-detail">
              <span class="tier-detail-label">Role in the Network</span>
              <p><span class="tier-statement">The clinical backbone.</span> Associates practise within the Institute's framework at depth, supervise Affiliates, participate in quarterly case conferencing, and their clinical data carries more weight in the registry due to supervised training.</p>
            </div>
            <button type="button" class="tier-cta-btn" data-tier="Tier II — Associate">Enquire about membership</button>
          </div>
        </div>
      </div>

      <div class="tier-band tier-fellow">
        <div class="tier-band-accent"></div>
        <div class="tier-band-inner">
          <div class="tier-band-left">
            <span class="tier-level-label">Tier III</span>
            <h3 class="tier-name">Fellow</h3>
            <a href="/education/fellowship" class="tier-credential-link">
              <span class="tier-credential-tag">Fellowship</span>
              <span class="tier-credential-suffix">holders</span>
            </a>
          </div>
          <div class="tier-band-right">
            <div class="tier-detail">
              <span class="tier-detail-label">Access</span>
              <p>Protocol development privileges. Faculty appointment eligibility. Regional clinical governance leadership.</p>
            </div>
            <div class="tier-detail">
              <span class="tier-detail-label">Role in the Network</span>
              <p>The governing layer. Fellows don't just use protocols — they develop them. They supervise Associates and Affiliates, lead regional governance, and are eligible for Institute faculty appointments.</p>
            </div>
            <span class="tier-included-badge">Membership included with Fellowship</span>
          </div>
        </div>
      </div>
    </section>

    <!-- FIELD INFRASTRUCTURE -->
    <section class="infrastructure-section" id="infrastructure">
      <span class="infra-eyebrow">Field Infrastructure</span>
      <h2 class="infra-heading">What runs underneath</h2>

      <div class="infra-grid">
        <div class="infra-item infra-registry">
          <div class="infra-stream" aria-hidden="true">
            <canvas class="infra-stream-canvas"></canvas>
          </div>
          <h3>Clinical Registry</h3>
          <p class="infra-lead">Every patient interaction using Institute protocols generates structured outcome data.</p>
          <p>De-identified. Aggregated across the entire Field. Fed directly into the clinical translation pipeline. This is practice-based evidence generation at scale — real-world outcomes replacing the wait for grant-funded trials. The protocols you use tomorrow are refined by the clinical work you do today.</p>
          <div class="infra-footer">
            <a href="/research" class="infra-btn">Research Programs</a>
          </div>
          <div class="infra-stat">
            <span class="infra-stat-pulse"></span>
            <span class="infra-stat-label">Registry active</span>
            <span class="infra-stat-sep">&middot;</span>
            <span class="infra-stat-label">Accepting practitioner data</span>
          </div>
        </div>

        <div class="infra-item infra-conferencing">
          <div class="infra-cluster" aria-hidden="true">
            <span class="cluster-node"></span>
            <span class="cluster-node"></span>
            <span class="cluster-node"></span>
            <span class="cluster-node"></span>
          </div>
          <h3>Case Conferencing</h3>
          <p class="infra-lead">Cross-divisional clinical reasoning, not informal peer discussion.</p>
          <p>Structured virtual case conferencing modelled on Medicare Team Care. A herbalist presents a complex case and gets input from a systems medicine practitioner and an environmental medicine specialist in the same session. Frequency is calibrated to your tier — peer conferencing for Affiliates, quarterly structured sessions for Associates, Fellows lead and facilitate.</p>
          <div class="infra-footer">
            <span class="infra-btn infra-btn-disabled">Sessions commence &middot; Q3 2026</span>
          </div>
          <div class="infra-stat">
            <span class="infra-stat-pulse"></span>
            <span class="infra-stat-label">Next session scheduling</span>
          </div>
        </div>
      </div>
    </section>


    <!-- PROTOCOL ACCESS -->
    <section class="protocol-section" id="protocols">
      <h2 class="section-heading">Protocol Access</h2>
      <p class="section-intro">The Institute's clinical protocols are tiered by evidence maturity — protocols move from investigational to provisional to validated as evidence accumulates. Your membership tier determines what you can access.</p>
      <div class="protocol-tiers">
        <div class="protocol-track">
          <div class="track-bg"></div>
          <div class="track-fill"></div>
        </div>

        <div class="protocol-tier tier-a">
          <div class="protocol-left">
            <span class="protocol-letter">A</span>
            <h3>Validated</h3>
          </div>
          <div class="protocol-right">
            <span class="protocol-access access-open">All network members</span>
            <p class="protocol-summary">Completed clinical pilot, peer-reviewed, distributed network-wide.</p>
            <p class="protocol-detail">Validated protocols have completed at least one supervised clinical pilot with documented outcomes, undergone internal peer review, and demonstrated reproducible results across multiple practitioners. These are the protocols the network stands behind — they represent the Institute's best current understanding of effective clinical practice in their domain.</p>
          </div>
        </div>

        <div class="protocol-tier tier-b">
          <div class="protocol-left">
            <span class="protocol-letter">B</span>
            <h3>Provisional</h3>
          </div>
          <div class="protocol-right">
            <span class="protocol-access access-restricted">Associates &amp; Fellows</span>
            <p class="protocol-summary">Active clinical pilot, preliminary data. Promising but not yet sufficient for network-wide distribution.</p>
            <p class="protocol-detail">Provisional protocols are in active clinical testing. Preliminary outcome data looks promising, but the evidence base isn't yet sufficient for network-wide distribution. Associates and Fellows can implement these under the supervision framework, and their clinical data feeds directly into the validation pipeline. This is where practitioners contribute most directly to the Institute's evidence base.</p>
          </div>
        </div>

        <div class="protocol-tier tier-c">
          <div class="protocol-left">
            <span class="protocol-letter">C</span>
            <h3>Investigational</h3>
          </div>
          <div class="protocol-right">
            <span class="protocol-access access-closed">Research only</span>
            <p class="protocol-summary">Research design phase. Developed from literature synthesis, preclinical evidence, or clinical observation.</p>
            <p class="protocol-detail">Investigational protocols are still in the research design phase — being developed from literature synthesis, preclinical evidence, or clinical observation. They haven't entered formal clinical piloting yet. Access is restricted to research settings, and they are not distributed through the practitioner network until they advance to Tier B.</p>
          </div>
        </div>
      </div>
    </section>

    <section class="join-section" id="join">
      <div class="join-inner">
        <div class="join-primary">
          <span class="join-eyebrow">Join The Field</span>
          <h2>Enter the Field</h2>
          <p>Your credential determines your entry point. The network gets stronger with every practitioner who joins.</p>
          <button type="button" class="join-primary-btn" id="join-apply-btn">Apply for membership</button>
        </div>
        <div class="join-secondary">
          <a href="/education" class="join-alt">
            <span class="join-alt-label">No credential yet?</span>
            <span class="join-alt-action">Start with the Foundation Certificate</span>
          </a>
          <a href="/contact" class="join-alt">
            <span class="join-alt-label">Institutional?</span>
            <span class="join-alt-action">Group credentialing enquiry</span>
          </a>
        </div>
      </div>
    </section>


    <!-- MEMBERSHIP ENQUIRY POPUP -->
    <div class="enquiry-overlay" id="enquiry-overlay">
      <div class="enquiry-popup">
        <button type="button" class="enquiry-close" id="enquiry-close" aria-label="Close">&times;</button>
        <span class="enquiry-eyebrow">Membership Enquiry</span>
        <h2 class="enquiry-heading">Join The Field</h2>
        <p class="enquiry-intro">Submit your details and we'll send you an information pack for your selected tier.</p>

        <form class="enquiry-form" id="enquiry-form">
          <div class="enquiry-row">
            <div class="enquiry-field">
              <label for="eq-name">Full Name</label>
              <input type="text" id="eq-name" name="name" required autocomplete="name" />
            </div>
            <div class="enquiry-field">
              <label for="eq-email">Email</label>
              <input type="email" id="eq-email" name="email" required autocomplete="email" />
            </div>
          </div>
          <div class="enquiry-row">
            <div class="enquiry-field">
              <label for="eq-practice">Practice Type</label>
              <select id="eq-practice" name="practice_type" required>
                <option value="">Select discipline</option>
                <option value="Naturopath">Naturopath</option>
                <option value="Herbalist">Herbalist</option>
                <option value="General Practitioner">General Practitioner</option>
                <option value="Acupuncturist / TCM">Acupuncturist / TCM</option>
                <option value="Nutritionist / Dietitian">Nutritionist / Dietitian</option>
                <option value="Psychologist / Psychotherapist">Psychologist / Psychotherapist</option>
                <option value="Nurse Practitioner">Nurse Practitioner</option>
                <option value="Other">Other</option>
              </select>
            </div>
            <div class="enquiry-field">
              <label for="eq-years">Years in Practice</label>
              <select id="eq-years" name="years_practice">
                <option value="">Select range</option>
                <option value="Student / Pre-registration">Student / Pre-registration</option>
                <option value="0–2 years">0–2 years</option>
                <option value="3–5 years">3–5 years</option>
                <option value="6–10 years">6–10 years</option>
                <option value="10+ years">10+ years</option>
              </select>
            </div>
          </div>
          <div class="enquiry-row">
            <div class="enquiry-field">
              <label for="eq-location">Practice Location</label>
              <input type="text" id="eq-location" name="location" placeholder="City, State" autocomplete="address-level2" />
            </div>
            <div class="enquiry-field">
              <label for="eq-tier">Tier of Interest</label>
              <select id="eq-tier" name="tier" required>
                <option value="">Select a tier</option>
                <option value="Tier I — Affiliate">Tier I — Affiliate</option>
                <option value="Tier II — Associate">Tier II — Associate</option>
                <option value="Tier III — Fellow">Tier III — Fellow</option>
              </select>
            </div>
          </div>
          <div class="enquiry-field">
            <label for="eq-qualifications">Current Qualifications &amp; Registrations</label>
            <input type="text" id="eq-qualifications" name="qualifications" placeholder="e.g. BHSc Naturopathy, ANTA member, AHPRA registered" />
          </div>
          <div class="enquiry-field">
            <label for="eq-interest">What interests you about the network?</label>
            <textarea id="eq-interest" name="interest" rows="3" placeholder="Clinical protocols, supervision, research participation, case conferencing..."></textarea>
          </div>
          <div class="enquiry-field">
            <label for="eq-referral">How did you hear about us?</label>
            <select id="eq-referral" name="referral">
              <option value="">Select</option>
              <option value="Institute education">Institute education</option>
              <option value="Colleague / referral">Colleague / referral</option>
              <option value="Conference / event">Conference / event</option>
              <option value="Online search">Online search</option>
              <option value="Social media">Social media</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <button type="submit" class="enquiry-submit">Send Enquiry</button>
        </form>

        <div class="enquiry-success" id="enquiry-success">
          <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="var(--accent-dark)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
          <h3>Enquiry Sent</h3>
          <p>We'll be in touch within 48 hours with your information pack.</p>
        </div>
      </div>
    </div>

  </article>
</PortalLayout>

<style>
  .network-page {
    font-family: 'Manrope', sans-serif;
    color: var(--text-heading);
    padding: 0;
  }
  .network-page p { line-height: 1.8; margin: 0 0 1rem; }
  .network-page p:last-child { margin-bottom: 0; }
  .network-page h2, .network-page h3 { margin: 0; }
  .network-page a { color: var(--accent-dark); text-decoration: none; transition: color 0.15s; }
  .network-page a:hover { color: var(--accent-darker-hover); }
  .network-page .tier-cta-btn { color: var(--text-heading); }
  .network-page .tier-cta-btn:hover { color: var(--text-heading); }
  .network-page .tier-band.active .tier-cta-btn { color: #fff; }
  :global([data-theme="dark"]) .network-page .tier-band.active .tier-cta-btn { color: #1a1a1a; }

  .network-page .join-primary-btn { color: #141210; }
  .network-page .join-primary-btn:hover { color: #141210; }
  .network-page a.join-alt { color: inherit; }
  .network-page a.join-alt:hover { color: inherit; }
  :global(.reading-progress) { display: none !important; }
  .network-page a.sticky-bar-login { color: rgba(255, 255, 255, 0.45); }
  .network-page a.sticky-bar-login:hover { color: rgba(255, 255, 255, 0.45); }
  .network-page a.hero-cta-primary { color: #141210; }
  .network-page a.hero-cta-primary:hover { color: #141210; }
  .network-page a.hero-cta-secondary { color: rgba(208, 200, 188, 0.7); }
  .network-page a.hero-cta-secondary:hover { color: #e8dfd0; }

  /* ═══════════ HERO ═══════════ */
  .network-hero {
    position: relative;
    max-width: none;
    margin: 0 -40px;
    padding: 0;
    background: #141210;
    overflow: hidden;
    min-height: 560px;
  }

  #network-mesh-canvas {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: block;
    z-index: 0;
    pointer-events: auto;
  }

  .hero-inner {
    position: relative;
    z-index: 1;
    padding: 96px calc(2rem + 40px) 64px calc(1rem + 40px);
    pointer-events: none;
  }
  .hero-inner a, .hero-inner button { pointer-events: auto; }

  .network-hero .section-label { color: #c45a42; }
  .network-hero .section-label::after { background: rgba(196, 90, 66, 0.18); }
  .network-hero .hero-title { color: #e8dfd0; }
  .network-hero .hero-lead { color: rgba(208, 200, 188, 0.65); }

  .section-label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--accent-dark);
    margin-bottom: 2rem;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--accent-line);
  }

  .hero-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2.5rem, 5vw, 4.75rem);
    font-weight: 500;
    line-height: 1.1;
    letter-spacing: -0.01em;
    color: var(--text-heading);
    max-width: 700px;
    margin: 0 0 24px;
  }

  .hero-lead {
    font-size: 1.0625rem;
    color: var(--text-secondary);
    line-height: 1.65;
    max-width: 640px;
    padding-left: 1.5rem;
    margin-bottom: 2rem;
  }

  .hero-cta-row {
    margin-top: 3rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    padding-left: 0;
  }

  .hero-cta-primary {
    display: inline-block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    color: #141210;
    background: rgba(245, 240, 232, 0.9);
    padding: 12px 28px;
    border-radius: 4px;
    text-decoration: none;
    transition: background 0.15s;
  }

  .hero-cta-primary:hover {
    background: #f1ece4;
    color: #141210;
  }

  .hero-cta-secondary {
    display: inline-block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    color: rgba(208, 200, 188, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.15);
    padding: 12px 28px;
    border-radius: 4px;
    text-decoration: none;
    transition: border-color 0.15s, color 0.15s;
  }

  .hero-cta-secondary:hover {
    border-color: var(--accent-dark);
    color: #e8dfd0;
  }

  /* Hero CTAs */
  /* Sticky bar */
  .network-sticky-bar {
    position: sticky;
    top: 0;
    z-index: 100;
    display: flex;
    align-items: center;
    justify-content: flex-end;
    padding: 0.75rem calc(1rem + 40px);
    margin: 0 -40px;
    background: rgba(20, 18, 15, 0.75);
    border-bottom: 1px solid rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
  }

  :global([data-theme="light"]) .network-sticky-bar {
    background: rgba(30, 25, 20, 0.8);
    border-bottom: 1px solid rgba(255, 255, 255, 0.08);
  }

  .sticky-bar-label {
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--accent-dark);
  }

  .sticky-bar-login {
    display: inline-block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    color: rgba(255, 255, 255, 0.45);
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.08);
    cursor: default;
    padding: 6px 18px;
    border-radius: 4px;
    text-decoration: none;
    transition: opacity 0.15s;
  }

  .sticky-bar-login:hover {
    opacity: 0.85;
  }

  /* ═══════════ ENQUIRY POPUP ═══════════ */
  .enquiry-overlay {
    position: fixed;
    inset: 0;
    z-index: 9999;
    background: rgba(0, 0, 0, 0.6);
    backdrop-filter: blur(4px);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s;
  }

  .enquiry-overlay.open {
    opacity: 1;
    pointer-events: auto;
  }

  .enquiry-popup {
    position: relative;
    width: 90%;
    max-width: 680px;
    max-height: 90vh;
    overflow-y: auto;
    background: var(--bg-surface);
    border: 1px solid var(--border-light);
    border-radius: 6px;
    padding: 3rem 2.5rem;
    transform: translateY(12px);
    transition: transform 0.25s;
  }

  .enquiry-overlay.open .enquiry-popup {
    transform: translateY(0);
  }

  .enquiry-close {
    position: absolute;
    top: 1rem;
    right: 1.25rem;
    background: none;
    border: none;
    font-size: 1.5rem;
    color: var(--text-tertiary);
    cursor: pointer;
    padding: 4px 8px;
    line-height: 1;
    transition: color 0.15s;
  }

  .enquiry-close:hover {
    color: var(--text-heading);
  }

  .enquiry-eyebrow {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--accent-dark);
    margin-bottom: 0.75rem;
  }

  .enquiry-heading {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 400;
    color: var(--text-heading);
    margin: 0 0 0.75rem;
  }

  .enquiry-intro {
    font-size: 0.8125rem;
    color: var(--text-body-60);
    line-height: 1.65;
    margin-bottom: 2rem;
  }

  .enquiry-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
  }

  .enquiry-field {
    margin-bottom: 1.25rem;
  }

  .enquiry-field label {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--text-tertiary);
    margin-bottom: 0.375rem;
  }

  .enquiry-field input,
  .enquiry-field select,
  .enquiry-field textarea {
    width: 100%;
    font-family: 'Manrope', sans-serif;
    font-size: 0.875rem;
    color: var(--text-heading);
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: 4px;
    padding: 10px 12px;
    transition: border-color 0.15s;
    box-sizing: border-box;
  }

  .enquiry-field input:focus,
  .enquiry-field select:focus,
  .enquiry-field textarea:focus {
    outline: none;
    border-color: var(--accent-dark);
  }

  .enquiry-field textarea {
    resize: vertical;
    min-height: 72px;
  }

  .enquiry-submit {
    display: inline-block;
    width: 100%;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    color: #141210;
    background: var(--accent-dark);
    border: none;
    border-radius: 4px;
    padding: 12px 28px;
    margin-top: 0.5rem;
    cursor: pointer;
    transition: background 0.15s;
  }

  .enquiry-submit:hover {
    background: #d4773a;
  }

  .enquiry-success {
    display: none;
    text-align: center;
    padding: 1rem 0;
  }

  .enquiry-success h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 400;
    color: var(--text-heading);
    margin: 1rem 0 0.5rem;
  }

  .enquiry-success p {
    font-size: 0.8125rem;
    color: var(--text-body-60);
    line-height: 1.65;
  }


  /* ═══════════ ENTER THE FIELD ═══════════ */
  .join-section {
    margin: 0 -40px;
    padding: 0;
    background: #141210;
    border-bottom: none;
  }

  .join-inner {
    max-width: 640px;
    margin: 0 auto;
    padding: 6rem 2rem;
    text-align: center;
  }

  .join-eyebrow {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: rgba(196, 110, 66, 0.7);
    margin-bottom: 1rem;
  }

  .join-primary h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 3rem;
    font-weight: 400;
    color: #e8dfd0;
    letter-spacing: -0.01em;
    margin: 0 0 1.25rem;
  }

  .join-primary p {
    font-size: 1rem;
    color: rgba(208, 200, 188, 0.55);
    line-height: 1.7;
    max-width: 440px;
    margin: 0 auto 2.5rem;
  }

  .join-primary-btn {
    display: inline-block;
    padding: 14px 40px;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 600;
    letter-spacing: 0.03em;
    color: #141210;
    background: var(--accent-dark);
    border: none;
    border-radius: 4px;
    text-decoration: none;
    transition: background 0.2s, transform 0.15s;
  }

  .join-primary-btn:hover {
    background: #d4773a;
    transform: translateY(-1px);
  }

  .join-secondary {
    display: flex;
    justify-content: center;
    gap: 3rem;
    margin-top: 3rem;
    padding-top: 2.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
  }

  .join-alt {
    text-decoration: none;
    text-align: center;
  }

  .join-alt-label {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: rgba(208, 200, 188, 0.35);
    margin-bottom: 0.375rem;
  }

  .join-alt-action {
    display: block;
    font-size: 0.8125rem;
    color: rgba(208, 200, 188, 0.6);
    transition: color 0.2s;
  }

  .join-alt:hover .join-alt-action {
    color: #e8dfd0;
  }


  /* ═══════════ SECTION HEADINGS ═══════════ */
  .network-page .section-heading {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.5rem;
    font-weight: 400;
    color: var(--text-heading);
    margin: 0 0 0.75rem;
    letter-spacing: -0.01em;
  }

  .network-page .section-intro {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    line-height: 1.65;
    max-width: 640px;
    margin-bottom: 2.5rem;
  }


  /* ═══════════ NETWORK TIERS ═══════════ */
  .tiers-section {
    padding: 4rem 0 0;
    margin-bottom: 0;
  }

  /* Tier bands — full width stacked */
  .tier-band {
    position: relative;
    display: flex;
    margin: 0 -40px;
    border-bottom: 1px solid var(--border-light);
  }

  .tier-band-accent {
    width: 4px;
    flex-shrink: 0;
  }

  .tier-band { transition: background 0.25s; }
  .tier-band.active { background: rgba(255, 255, 255, 0.03); }
  :global([data-theme="light"]) .tier-band.active { background: rgba(255, 255, 255, 0.5); }

  .tier-band-accent { background: var(--border-medium); transition: background 0.25s; }
  .tier-band.active .tier-band-accent { background: var(--accent-dark); }

  .tier-band-inner {
    display: grid;
    grid-template-columns: 280px 1fr;
    gap: 3rem;
    padding: 2.5rem calc(10rem + 40px) 2.5rem 2.5rem;
    width: 100%;
  }

  .tier-band-left {
    display: flex;
    flex-direction: column;
    position: sticky;
    top: 2rem;
    align-self: start;
  }

  .tier-level-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6875rem;
    font-weight: 500;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    margin-bottom: 0.5rem;
  }

  .tier-level-label { color: var(--text-tertiary); opacity: 0.6; transition: color 0.2s, opacity 0.2s; }
  .tier-band.active .tier-level-label { color: var(--accent-dark); opacity: 1; }

  .tier-name {
    font-family: 'Cormorant Garamond', serif;
    font-weight: 400;
    color: var(--text-heading);
    line-height: 1.1;
    padding-bottom: 0.875rem;
  }

  .tier-affiliate .tier-name { font-size: 2.75rem; }
  .tier-associate .tier-name { font-size: 2.75rem; }
  .tier-fellow .tier-name { font-size: 2.75rem; }

  .tier-credential-link {
    display: inline-flex;
    align-items: baseline;
    gap: 4px;
    text-decoration: none;
    transition: opacity 0.15s;
  }

  .tier-credential-link:hover {
    opacity: 0.85;
  }

  .tier-credential-tag {
    font-family: 'Manrope', sans-serif;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--text-tertiary);
  }

  .tier-credential-suffix {
    font-family: 'Manrope', sans-serif;
    font-size: 0.875rem;
    font-weight: 500;
    color: var(--text-tertiary);
  }

  .tier-cta-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    align-self: flex-start;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    color: var(--text-heading);
    background: rgba(196, 155, 104, 0.12);
    border: 1px solid rgba(196, 155, 104, 0.25);
    border-radius: 4px;
    padding: 10px 22px;
    text-decoration: none;
    margin-top: 0.5rem;
    opacity: 0.35;
    transition: border-color 0.15s, background 0.15s, color 0.15s, opacity 0.2s;
  }

  .tier-band.active .tier-cta-btn {
    opacity: 1;
    color: #fff;
    background: var(--accent-dark);
    border-color: var(--accent-dark);
  }

  .tier-arrow {
    transition: transform 0.15s;
  }

  .tier-cta-btn:hover {
    background: var(--accent-darker-hover);
    border-color: var(--accent-darker-hover);
  }

  .tier-cta-btn:hover .tier-arrow {
    transform: translateX(3px);
  }

  .tier-included-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    align-self: flex-start;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 600;
    letter-spacing: 0.02em;
    color: var(--text-heading);
    background: rgba(196, 155, 104, 0.12);
    border: 1px solid rgba(196, 155, 104, 0.25);
    border-radius: 4px;
    padding: 10px 22px;
    margin-top: 0.5rem;
    opacity: 0.35;
    transition: opacity 0.2s;
  }

  .tier-band.active .tier-included-badge {
    opacity: 0.5;
  }

  .tier-band-right {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .tier-detail {
    /* no container, just flow */
  }

  .tier-detail-label {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 0.5rem;
    transition: color 0.2s, opacity 0.2s;
  }

  .tier-affiliate .tier-detail-label { color: var(--text-heading); opacity: 0.45; }
  .tier-associate .tier-detail-label { color: var(--text-heading); opacity: 0.45; }
  .tier-fellow .tier-detail-label { color: var(--text-heading); opacity: 0.45; }

  .tier-band.active .tier-detail-label { color: var(--accent-dark); opacity: 0.7; }

  .tier-detail p {
    font-size: 0.9375rem;
    color: var(--text-body-65);
    line-height: 1.75;
  }

  .tier-statement {
    font-weight: inherit;
    color: inherit;
  }

  /* Fellow band — same as other tiers */


  /* ═══════════ INFRASTRUCTURE ═══════════ */
  .infrastructure-section {
    padding: 7rem 0 7rem;
    margin-bottom: 0;
    border-bottom: 1px solid var(--border-light);
  }

  .infra-eyebrow {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--accent-dark);
    opacity: 0.7;
    margin-bottom: 0.75rem;
  }

  .network-page .infra-heading {
    font-family: 'Cormorant Garamond', serif;
    font-size: 3rem;
    font-weight: 400;
    line-height: 1.15;
    color: var(--text-heading);
    letter-spacing: -0.01em;
    margin: 0 0 4rem;
  }

  .infra-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
  }

  .infra-item {
    position: relative;
    display: flex;
    flex-direction: column;
    padding: 2.5rem 1.5rem 2rem;
    border: 1px solid var(--border-light);
    border-radius: 2px;
    overflow: hidden;
  }

  .infra-item h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.75rem;
    font-weight: 500;
    color: var(--text-heading);
    margin: 0 0 1.25rem;
  }

  .infra-item p.infra-lead {
    font-size: 0.9375rem;
    font-weight: 600;
    color: var(--text-heading);
    line-height: 2;
    margin: 0 0 0.5rem;
  }

  .infra-item p {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    line-height: 2;
    margin: 0 0 0;
  }

  .infra-item a {
    color: var(--accent-dark);
    opacity: 0.7;
    transition: opacity 0.2s;
  }

  .infra-item a:hover {
    opacity: 1;
  }

  .infra-footer {
    margin-top: auto;
    padding-top: 2rem;
  }

  .infra-btn {
    display: block;
    width: 100%;
    padding: 14px 20px;
    text-align: center;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 600;
    letter-spacing: 0.03em;
    color: #d4773a;
    background: rgba(196, 110, 66, 0.06);
    border: 1px solid rgba(196, 110, 66, 0.15);
    border-radius: 3px;
    opacity: 1;
    transition: background 0.2s, border-color 0.2s;
  }

  .infra-btn:hover {
    background: rgba(196, 110, 66, 0.12);
    border-color: rgba(196, 110, 66, 0.3);
    opacity: 1;
  }

  .infra-btn-disabled {
    color: var(--text-tertiary);
    background: rgba(128, 128, 128, 0.05);
    border-color: var(--border-light);
    cursor: default;
    opacity: 0.5;
  }

  .infra-btn-disabled:hover {
    background: rgba(128, 128, 128, 0.05);
    border-color: var(--border-light);
    opacity: 0.5;
  }

  /* ── Status strip ── */
  .infra-stat {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1.5rem;
    padding-top: 1.25rem;
    border-top: 1px solid var(--border-light);
  }

  .infra-stat-pulse {
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--accent-dark);
    flex-shrink: 0;
    animation: statusPulse 2.5s ease-in-out infinite;
  }

  @keyframes statusPulse {
    0%, 100% { opacity: 0.4; }
    50% { opacity: 1; }
  }

  .infra-stat-label {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.75rem;
    color: var(--text-tertiary);
    letter-spacing: 0.02em;
  }

  .infra-stat-sep {
    color: var(--border-medium);
    font-size: 0.5rem;
  }

  /* ── Registry — data stream canvas ── */
  .infra-stream {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    overflow: hidden;
  }

  .infra-stream-canvas {
    display: block;
    width: 100%;
    height: 100%;
  }

  /* ── Conferencing — pulsing avatar cluster ── */
  .infra-cluster {
    position: absolute;
    top: 1.5rem;
    right: 1.75rem;
    display: flex;
    gap: 0;
  }

  .cluster-node {
    width: 22px;
    height: 22px;
    border-radius: 50%;
    background: var(--border-light);
    border: 2px solid var(--bg-primary);
    margin-left: -6px;
    animation: clusterPulse 4s ease-in-out infinite;
  }

  .cluster-node:first-child { margin-left: 0; }
  .cluster-node:nth-child(1) { z-index: 4; animation-delay: 0s; }
  .cluster-node:nth-child(2) { z-index: 3; animation-delay: 0.8s; }
  .cluster-node:nth-child(3) { z-index: 2; animation-delay: 1.6s; }
  .cluster-node:nth-child(4) { z-index: 1; animation-delay: 2.4s; }

  @keyframes clusterPulse {
    0%, 100% { background: var(--border-light); }
    30% { background: rgba(196, 110, 66, 0.5); }
    50% { background: var(--border-light); }
  }


  /* ═══════════ PROTOCOL ACCESS ═══════════ */
  .protocol-section {
    padding: 7rem 0 4rem;
    margin-bottom: 0;
    border-bottom: 1px solid var(--border-light);
    text-align: center;
  }

  .protocol-section .section-intro {
    margin-left: auto;
    margin-right: auto;
  }

  .protocol-tiers {
    position: relative;
    max-width: 720px;
    margin: 0 auto;
  }

  /* ── Continuous progress track ── */
  .protocol-track {
    position: absolute;
    left: calc(180px + 1rem);
    top: 2rem;
    bottom: 2rem;
    width: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1;
    pointer-events: none;
  }

  .track-bg {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border-light);
  }

  .track-fill {
    position: absolute;
    top: 0;
    width: 2px;
    height: 0;
    background: var(--accent-dark);
  }


  /* ── Shared tier — two-column layout ── */
  .protocol-tier {
    display: grid;
    grid-template-columns: 180px 1fr;
    gap: 0 calc(24px + 4rem);
    padding: 7rem 0;
  }

  /* Left column — identity */
  .protocol-left {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .protocol-letter {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 52px;
    height: 52px;
    border-radius: 50%;
    border: 2px solid var(--border-light);
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.25rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    line-height: 1;
    margin-bottom: 0.75rem;
    overflow: visible;
    transition: border-color 0.3s, color 0.3s;
  }

  .protocol-left h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.75rem;
    font-weight: 500;
    color: var(--text-heading);
    line-height: 1.1;
    margin: 0 0 0.625rem;
  }

  .protocol-access {
    display: inline-block;
    margin-bottom: 1rem;
    font-family: 'Manrope', sans-serif;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 2px;
  }

  .protocol-access {
    color: var(--text-tertiary);
    background: transparent;
    border: 1px solid var(--border-light);
    transition: color 0.25s, border-color 0.25s, background 0.25s;
  }

  .protocol-tier.active .protocol-access {
    color: var(--accent-dark);
    border-color: rgba(196, 155, 104, 0.3);
    background: rgba(196, 155, 104, 0.08);
  }

  /* Right column — content, scroll-reveal */
  .protocol-right {
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 0.5s ease, transform 0.5s ease;
    max-width: 480px;
    text-align: left;
  }

  .protocol-right.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .protocol-summary {
    font-size: 1.25rem;
    color: var(--text-tertiary);
    line-height: 1.7;
    margin: 0 0 0.875rem;
    transition: color 0.3s;
  }

  .protocol-detail {
    font-size: 0.9375rem;
    color: var(--text-tertiary);
    line-height: 1.8;
    margin: 0;
    opacity: 0.6;
    transition: opacity 0.3s, color 0.3s;
  }

  /* ── Tier colours (default) ── */
  .protocol-letter {
    color: var(--text-tertiary);
    transition: color 0.25s, border-color 0.25s;
  }

  .protocol-left h3 {
    color: var(--text-tertiary);
    transition: color 0.25s;
  }

  /* ── Scroll-based active state ── */
  .protocol-tier.active .protocol-letter {
    color: var(--accent-dark);
    border-color: var(--accent-dark);
  }

  .protocol-tier.active .protocol-left h3 {
    color: var(--text-heading);
  }

  .protocol-tier.active .protocol-summary {
    color: var(--text-heading);
  }

  .protocol-tier.active .protocol-detail {
    opacity: 1;
  }

  /* ── Spark burst on activation ── */
  .protocol-letter .spark {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 4px;
    height: 4px;
    margin: -2px 0 0 -2px;
    border-radius: 50%;
    background: var(--accent-dark);
    opacity: 0;
    pointer-events: none;
    z-index: 10;
  }

  .protocol-letter .spark.fire {
    animation: sparkBurst 0.7s ease-out forwards;
  }

  @keyframes sparkBurst {
    0% { opacity: 1; transform: translate(0, 0) scale(1.2); }
    40% { opacity: 0.9; }
    100% { opacity: 0; transform: var(--spark-dir) scale(0); }
  }







  /* ═══════════ RESPONSIVE ═══════════ */
  @media (max-width: 1024px) {
    .network-hero {
      margin: 0 -20px;
      min-height: 450px;
    }

    .hero-inner {
      padding: 64px calc(1.5rem + 20px) 48px calc(1rem + 20px);
    }

    .tier-band { margin: 0 -20px; }
    .tier-band-inner { padding: 2.5rem calc(1rem + 16px) 2.5rem 2rem; }
  }

  @media (max-width: 768px) {
    .network-hero { min-height: 380px; }
    #network-mesh-canvas { pointer-events: none; }

    .hero-inner {
      padding: 48px 1.25rem 36px;
    }

    .hero-title {
      font-size: 3.5rem;
    }

    .hero-lead {
      padding-left: 0;
    }

    .tier-band { margin: 0 -20px; }
    .tier-band-inner {
      grid-template-columns: 1fr;
      gap: 1.25rem;
      padding: 2rem 1.25rem;
    }
    .tier-band-left {
      position: static;
    }
    .tier-name { margin-bottom: 0; padding-bottom: 0.25rem; }
    .tier-band-right { padding-top: 0.5rem; }

    .infra-grid {
      grid-template-columns: 1fr;
    }

    .enquiry-row { grid-template-columns: 1fr; }
    .enquiry-popup { padding: 2.5rem 1.5rem; }

    .join-section { margin: 0 -20px; }
    .join-inner { padding: 4rem 1.25rem; }
    .join-primary h2 { font-size: 2.25rem; }
    .join-secondary { flex-direction: column; gap: 1.5rem; }

    .protocol-tier { grid-template-columns: 1fr; gap: 1rem; }
    .protocol-track { display: none; }
    .protocol-left { align-items: flex-start; text-align: left; }
    .protocol-right { opacity: 1; transform: none; }

    .tiers-section,
    .infrastructure-section,
    .protocol-section {
      padding: 3rem 0;
    }
  }

  @media (max-width: 640px) {
    .network-hero {
      margin: 0 -20px;
      min-height: 350px;
    }

    .hero-inner {
      padding: 48px 1.25rem 0;
    }

    .hero-title {
      font-size: 3rem;
    }

    .hero-cta-primary,
    .hero-cta-secondary {
      padding: 10px 16px;
    }

    .network-page .section-heading {
      font-size: 2rem;
      line-height: 1.15;
    }
  }
</style>

<script>
  function initTierObserver() {
    const bands = document.querySelectorAll('.tier-band');
    if (!bands.length) return;

    function updateActive() {
      const midY = window.innerHeight / 2;
      let closest = null;
      let closestDist = Infinity;

      bands.forEach(band => {
        const rect = band.getBoundingClientRect();
        const bandMid = rect.top + rect.height / 2;
        const dist = Math.abs(bandMid - midY);
        if (dist < closestDist) {
          closestDist = dist;
          closest = band;
        }
      });

      bands.forEach(band => band.classList.toggle('active', band === closest));
    }

    window.addEventListener('scroll', updateActive, { passive: true });
    updateActive();
  }

  initTierObserver();

  function initProtocolReveal() {
    const rights = document.querySelectorAll('.protocol-right');
    if (!rights.length) return;
    const obs = new IntersectionObserver((entries) => {
      entries.forEach(e => {
        if (e.isIntersecting) {
          e.target.classList.add('visible');
          obs.unobserve(e.target);
        }
      });
    }, { rootMargin: '-10% 0px', threshold: 0.1 });
    rights.forEach(el => obs.observe(el));
  }

  function initProtocolFocus() {
    const tiers = document.querySelectorAll('.protocol-tier');
    const track = document.querySelector('.protocol-track');
    const fill = document.querySelector('.track-fill');
    const section = document.querySelector('.protocol-section');
    if (!tiers.length || !track || !fill || !section) return;

    const sparked = new Set();

    function emitSparks(letter) {
      const count = 8;
      for (let i = 0; i < count; i++) {
        const spark = document.createElement('span');
        spark.className = 'spark';
        const angle = (i / count) * Math.PI * 2;
        const dist = 18 + Math.random() * 12;
        const tx = Math.cos(angle) * dist;
        const ty = Math.sin(angle) * dist;
        spark.style.setProperty('--spark-dir', `translate(${tx}px, ${ty}px)`);
        letter.appendChild(spark);
        requestAnimationFrame(() => spark.classList.add('fire'));
        setTimeout(() => spark.remove(), 650);
      }
    }

    function update() {
      const trackRect = track.getBoundingClientRect();
      const trackH = trackRect.height;
      if (trackH <= 0) return;

      // Continuous scroll progress through the section
      const sectionRect = section.getBoundingClientRect();
      const trigger = window.innerHeight * 0.55;
      const scrollStart = sectionRect.top + window.innerHeight * 0.2;
      const scrollEnd = sectionRect.bottom - window.innerHeight * 0.4;
      const scrollRange = scrollEnd - scrollStart;
      const progress = Math.max(0, Math.min(1, (trigger - scrollStart) / scrollRange));

      // Map progress to track height
      const fillPx = progress * trackH;
      fill.style.height = fillPx + 'px';

      // Active tier based on scroll midpoint
      const midY = window.innerHeight * 0.55;
      let activeIdx = -1;
      tiers.forEach((tier, i) => {
        const r = tier.getBoundingClientRect();
        if (r.top < midY) activeIdx = i;
      });
      tiers.forEach((tier, i) => {
        const wasActive = tier.classList.contains('active');
        const nowActive = i <= activeIdx;
        tier.classList.toggle('active', nowActive);

        // Emit sparks when tier first activates
        if (nowActive && !sparked.has(i)) {
          sparked.add(i);
          const letter = tier.querySelector('.protocol-letter');
          if (letter) emitSparks(letter);
        }
        if (!nowActive) sparked.delete(i);
      });
    }

    window.addEventListener('scroll', update, { passive: true });
    window.addEventListener('resize', update, { passive: true });
    update();
  }

  initProtocolReveal();
  initProtocolFocus();

  // ─── Registry data stream animation ───
  function initDataStream() {
    const canvas = document.querySelector('.infra-stream-canvas') as HTMLCanvasElement;
    if (!canvas) return;
    const ctx = canvas.getContext('2d');
    if (!ctx) return;

    const dpr = window.devicePixelRatio || 1;
    const rect = canvas.parentElement!.getBoundingClientRect();
    canvas.width = rect.width * dpr;
    canvas.height = rect.height * dpr;
    ctx.scale(dpr, dpr);
    const W = rect.width, H = rect.height;

    const particles: { x: number; speed: number; alpha: number }[] = [];
    for (let i = 0; i < 30; i++) {
      particles.push({
        x: Math.random() * W,
        speed: 0.3 + Math.random() * 0.8,
        alpha: 0.2 + Math.random() * 0.5
      });
    }

    let animId = 0;
    function draw() {
      ctx!.clearRect(0, 0, W, H);
      for (const p of particles) {
        p.x += p.speed;
        if (p.x > W) { p.x = 0; p.alpha = 0.2 + Math.random() * 0.5; }
        ctx!.fillStyle = `rgba(196, 110, 66, ${p.alpha})`;
        ctx!.fillRect(p.x, 0, 2, H);
      }
      animId = requestAnimationFrame(draw);
    }

    const obs = new IntersectionObserver(entries => {
      if (entries[0].isIntersecting) { if (!animId) draw(); }
      else { cancelAnimationFrame(animId); animId = 0; }
    }, { threshold: 0.1 });
    obs.observe(canvas);
  }

  initDataStream();

  function initEnquiryPopup() {
    const overlay = document.getElementById('enquiry-overlay');
    const closeBtn = document.getElementById('enquiry-close');
    const form = document.getElementById('enquiry-form');
    const success = document.getElementById('enquiry-success');
    const tierSelect = document.getElementById('eq-tier');
    if (!overlay || !form) return;

    function openPopup(tier) {
      if (tierSelect) tierSelect.value = tier || '';
      form.style.display = '';
      success.style.display = 'none';
      overlay.classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    // Open popup from tier CTA buttons
    document.querySelectorAll('.tier-cta-btn[data-tier]').forEach(btn => {
      btn.addEventListener('click', () => openPopup(btn.dataset.tier));
    });

    // Open popup from bottom CTA
    const joinBtn = document.getElementById('join-apply-btn');
    joinBtn?.addEventListener('click', () => openPopup(''));

    // Close
    function close() {
      overlay.classList.remove('open');
      document.body.style.overflow = '';
    }

    closeBtn?.addEventListener('click', close);
    overlay.addEventListener('click', (e) => {
      if (e.target === overlay) close();
    });
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && overlay.classList.contains('open')) close();
    });

    // Submit
    form.addEventListener('submit', (e) => {
      e.preventDefault();
      form.style.display = 'none';
      success.style.display = 'block';
    });
  }

  initEnquiryPopup();

  document.addEventListener('astro:page-load', () => {
    initTierObserver();
    initProtocolReveal();
    initProtocolFocus();
    initDataStream();
    initEnquiryPopup();
  });
</script>

<script is:inline>
var _meshCleanup = null
function initNetworkMesh() {
  if (_meshCleanup) { _meshCleanup(); _meshCleanup = null }

  var reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches
  var canvas = document.getElementById('network-mesh-canvas')
  if (!canvas || reducedMotion) return
  var ctx = canvas.getContext('2d')
  if (!ctx) return
  var hero = canvas.closest('.network-hero')
  if (!hero) return

  // ─── Constants ───
  var MESH_R = 196, MESH_G = 110, MESH_B = 66
  var AFFILIATE_R = 2.5, ASSOCIATE_R = 4.5, FELLOW_R = 7
  var AFFILIATE_DIST = 130, ASSOCIATE_DIST = 170
  var BUILD_DUR = 2500
  var FELLOW_PULSE_INT = 9000
  var CONVERGE_INT = 13000
  var SPRING_K = 0.02
  var DAMPING = 0.88
  var CURSOR_RADIUS = 90
  var CURSOR_FORCE = 6

  // ─── Responsive config ───
  function getConfig() {
    var w = hero.getBoundingClientRect().width
    if (w > 1024) return { particles: 200, interact: true }
    if (w > 768)  return { particles: 120, interact: true }
    return { particles: 60, interact: false }
  }
  var cfg = getConfig()

  // ─── Canvas sizing ───
  var W, H, dpr
  function resize() {
    var rect = hero.getBoundingClientRect()
    dpr = window.devicePixelRatio || 1
    W = rect.width; H = rect.height
    canvas.width = W * dpr; canvas.height = H * dpr
    canvas.style.width = W + 'px'; canvas.style.height = H + 'px'
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0)
    cfg = getConfig()
    layoutNodes()
  }
  var resizeTimer = 0
  function debouncedResize() { clearTimeout(resizeTimer); resizeTimer = setTimeout(resize, 200) }

  // ─── Fixed node definitions (normalized 0-1 coordinates) ───
  var FIXED_NODES = [
    // Fellows (3) — bridge positions
    { nx: 0.68, ny: 0.35, tier: 2 },
    { nx: 0.82, ny: 0.62, tier: 2 },
    { nx: 0.58, ny: 0.72, tier: 2 },
    // Associates (12)
    { nx: 0.62, ny: 0.18, tier: 1 }, { nx: 0.72, ny: 0.22, tier: 1 },
    { nx: 0.88, ny: 0.28, tier: 1 }, { nx: 0.78, ny: 0.42, tier: 1 },
    { nx: 0.55, ny: 0.45, tier: 1 }, { nx: 0.92, ny: 0.50, tier: 1 },
    { nx: 0.65, ny: 0.58, tier: 1 }, { nx: 0.90, ny: 0.72, tier: 1 },
    { nx: 0.72, ny: 0.82, tier: 1 }, { nx: 0.58, ny: 0.88, tier: 1 },
    { nx: 0.85, ny: 0.85, tier: 1 }, { nx: 0.50, ny: 0.30, tier: 1 },
    // Affiliates (35)
    { nx: 0.55, ny: 0.12, tier: 0 }, { nx: 0.66, ny: 0.10, tier: 0 },
    { nx: 0.78, ny: 0.14, tier: 0 }, { nx: 0.85, ny: 0.18, tier: 0 },
    { nx: 0.93, ny: 0.22, tier: 0 }, { nx: 0.50, ny: 0.22, tier: 0 },
    { nx: 0.60, ny: 0.28, tier: 0 }, { nx: 0.75, ny: 0.30, tier: 0 },
    { nx: 0.88, ny: 0.36, tier: 0 }, { nx: 0.95, ny: 0.40, tier: 0 },
    { nx: 0.48, ny: 0.38, tier: 0 }, { nx: 0.58, ny: 0.35, tier: 0 },
    { nx: 0.70, ny: 0.48, tier: 0 }, { nx: 0.85, ny: 0.48, tier: 0 },
    { nx: 0.52, ny: 0.52, tier: 0 }, { nx: 0.60, ny: 0.50, tier: 0 },
    { nx: 0.78, ny: 0.55, tier: 0 }, { nx: 0.93, ny: 0.58, tier: 0 },
    { nx: 0.50, ny: 0.62, tier: 0 }, { nx: 0.70, ny: 0.65, tier: 0 },
    { nx: 0.88, ny: 0.66, tier: 0 }, { nx: 0.55, ny: 0.75, tier: 0 },
    { nx: 0.65, ny: 0.70, tier: 0 }, { nx: 0.78, ny: 0.75, tier: 0 },
    { nx: 0.95, ny: 0.78, tier: 0 }, { nx: 0.48, ny: 0.82, tier: 0 },
    { nx: 0.62, ny: 0.85, tier: 0 }, { nx: 0.75, ny: 0.88, tier: 0 },
    { nx: 0.90, ny: 0.90, tier: 0 }, { nx: 0.52, ny: 0.92, tier: 0 },
    { nx: 0.68, ny: 0.92, tier: 0 }, { nx: 0.82, ny: 0.95, tier: 0 },
    { nx: 0.45, ny: 0.15, tier: 0 }, { nx: 0.95, ny: 0.12, tier: 0 },
    { nx: 0.45, ny: 0.95, tier: 0 }
  ]
  var NODE_COUNT = FIXED_NODES.length

  // ─── Node pool (stride 14) ───
  var NS = 14
  // [0]x [1]y [2]homeX [3]homeY [4]vx [5]vy [6]tier [7]radius
  // [8]alpha [9]targetAlpha [10]glowIntensity [11]pulseTime [12]mass [13]driftPhase
  var nodes = new Float32Array(NODE_COUNT * NS)

  // ─── Connection pool ───
  var MAX_CONN = 400
  var connA = new Uint16Array(MAX_CONN)
  var connB = new Uint16Array(MAX_CONN)
  var connAlpha = new Float32Array(MAX_CONN)
  var connRestLen = new Float32Array(MAX_CONN)
  var connCount = 0

  // ─── Particle pool (stride 8) ───
  var PS = 8, MAX_P = 300
  var particles = new Float32Array(MAX_P * PS)
  var particleCount = 0

  // ─── State ───
  var visible = false, animId = 0, lastFrame = 0, time = 0
  var buildPhase = 0, buildStart = 0
  var lastFellowPulse = 0, lastConverge = 0
  var mouseX = -9999, mouseY = -9999
  var fpsLowCount = 0, perfLevel = 0
  var convergeActive = 0

  // ─── Helpers ───
  function rgba(a) { return 'rgba(' + MESH_R + ',' + MESH_G + ',' + MESH_B + ',' + a + ')' }
  function easeOutCubic(t) { return 1 - Math.pow(1 - t, 3) }

  // ─── Layout nodes to current canvas size ───
  function layoutNodes() {
    for (var i = 0; i < NODE_COUNT; i++) {
      var def = FIXED_NODES[i]
      var b = i * NS
      var x = def.nx * W, y = def.ny * H
      var r = def.tier === 2 ? FELLOW_R : def.tier === 1 ? ASSOCIATE_R : AFFILIATE_R
      var mass = def.tier === 2 ? 4 : def.tier === 1 ? 2 : 1
      nodes[b + 2] = x; nodes[b + 3] = y
      if (buildPhase === 0) { nodes[b] = x; nodes[b + 1] = y }
      else { nodes[b] = def.nx * W; nodes[b + 1] = def.ny * H }
      nodes[b + 4] = 0; nodes[b + 5] = 0
      nodes[b + 6] = def.tier; nodes[b + 7] = r
      nodes[b + 9] = def.tier === 2 ? 0.9 : def.tier === 1 ? 0.7 : 0.5
      nodes[b + 12] = mass; nodes[b + 13] = i * 0.7
    }
    buildConnections()
    if (particleCount === 0) spawnParticles()
  }

  // ─── Build connections (fixed topology) ───
  function buildConnections() {
    connCount = 0
    for (var i = 0; i < NODE_COUNT; i++) {
      var bi = i * NS; var ti = nodes[bi + 6]
      for (var j = i + 1; j < NODE_COUNT; j++) {
        if (connCount >= MAX_CONN) return
        var bj = j * NS; var tj = nodes[bj + 6]
        var dx = nodes[bi + 2] - nodes[bj + 2], dy = nodes[bi + 3] - nodes[bj + 3]
        var d = Math.sqrt(dx * dx + dy * dy)
        var maxTier = Math.max(ti, tj)
        var thresh = maxTier === 2 ? W * 0.5 : maxTier === 1 ? ASSOCIATE_DIST : AFFILIATE_DIST
        if (d < thresh) {
          connA[connCount] = i; connB[connCount] = j
          connAlpha[connCount] = 1; connRestLen[connCount] = d
          connCount++
        }
      }
    }
  }

  // ─── Particle spawning ───
  function spawnParticles() {
    particleCount = 0
    var maxP = Math.min(cfg.particles, MAX_P)
    for (var i = 0; i < maxP; i++) {
      var b = i * PS
      particles[b] = Math.floor(Math.random() * Math.max(1, connCount))
      particles[b + 1] = Math.random()
      particles[b + 2] = 0.002 + Math.random() * 0.003
      particles[b + 3] = Math.random() < 0.5 ? 1 : -1
      particles[b + 4] = 1
      particles[b + 5] = 0.3 + Math.random() * 0.4
    }
    particleCount = maxP
  }

  // ─── Initial setup ───
  resize()
  layoutNodes()

  // ─── Build sequence ───
  function updateBuild(now) {
    if (buildPhase === 0) return
    if (buildPhase === 2) {
      for (var i = 0; i < NODE_COUNT; i++) {
        var b = i * NS
        if (nodes[b + 8] < nodes[b + 9]) nodes[b + 8] += (nodes[b + 9] - nodes[b + 8]) * 0.03
      }
      return
    }
    var progress = Math.min(1, (now - buildStart) / BUILD_DUR)
    var ep = easeOutCubic(progress)
    var revealCount = Math.floor(ep * NODE_COUNT)
    for (var i = 0; i < NODE_COUNT; i++) {
      var b = i * NS
      if (i < revealCount) {
        var ta = nodes[b + 9]
        if (nodes[b + 8] < ta) nodes[b + 8] += (ta - nodes[b + 8]) * 0.05
      } else { nodes[b + 8] = 0 }
    }
    if (progress >= 1) buildPhase = 2
  }

  // ─── Fellow outward pulse ───
  function updateFellowPulse(now) {
    if (buildPhase < 2 || now - lastFellowPulse < FELLOW_PULSE_INT) return
    lastFellowPulse = now
    var fellows = []
    for (var i = 0; i < NODE_COUNT; i++) { if (nodes[i * NS + 6] === 2) fellows.push(i) }
    if (!fellows.length) return
    var start = fellows[Math.floor(Math.random() * fellows.length)]
    var visited = new Uint8Array(NODE_COUNT)
    var queue = [{ idx: start, hop: 0 }]
    visited[start] = 1
    while (queue.length) {
      var cur = queue.shift(); var b = cur.idx * NS
      nodes[b + 11] = now + cur.hop * 150
      nodes[b + 10] = Math.min(1, nodes[b + 10] + 0.1)
      if (cur.hop >= 4) continue
      for (var c = 0; c < connCount; c++) {
        var nb = -1
        if (connA[c] === cur.idx) nb = connB[c]
        else if (connB[c] === cur.idx) nb = connA[c]
        if (nb >= 0 && !visited[nb]) { visited[nb] = 1; queue.push({ idx: nb, hop: cur.hop + 1 }) }
      }
    }
  }

  // ─── Convergent pulse ───
  function updateConverge(now) {
    if (buildPhase < 2 || now - lastConverge < CONVERGE_INT) return
    lastConverge = now
    for (var i = 0; i < NODE_COUNT; i++) {
      if (nodes[i * NS + 6] === 0) nodes[i * NS + 10] = Math.min(1, nodes[i * NS + 10] + 0.35)
    }
    convergeActive = now
  }

  // ─── Spring physics — connections pull nodes toward rest length ───
  function updateSprings() {
    for (var c = 0; c < connCount; c++) {
      var ba = connA[c] * NS, bb = connB[c] * NS
      var dx = nodes[bb] - nodes[ba], dy = nodes[bb + 1] - nodes[ba + 1]
      var d = Math.sqrt(dx * dx + dy * dy) || 0.01
      var diff = d - connRestLen[c]
      var force = diff * SPRING_K * 0.3
      var fx = (dx / d) * force, fy = (dy / d) * force
      var mA = nodes[ba + 12], mB = nodes[bb + 12], totalM = mA + mB
      nodes[ba + 4] += fx * (mB / totalM); nodes[ba + 5] += fy * (mB / totalM)
      nodes[bb + 4] -= fx * (mA / totalM); nodes[bb + 5] -= fy * (mA / totalM)
    }
  }

  // ─── Cursor interaction — push nodes, propagates via springs ───
  function updateCursor() {
    if (!cfg.interact || mouseX < -1000) return
    for (var i = 0; i < NODE_COUNT; i++) {
      var b = i * NS
      var dx = nodes[b] - mouseX, dy = nodes[b + 1] - mouseY
      var d = Math.sqrt(dx * dx + dy * dy)
      if (d < CURSOR_RADIUS) {
        var influence = 1 - d / CURSOR_RADIUS; influence *= influence
        var pushF = influence * CURSOR_FORCE / nodes[b + 12]
        var nx = dx / (d || 1), ny = dy / (d || 1)
        nodes[b + 4] += nx * pushF; nodes[b + 5] += ny * pushF
        nodes[b + 10] = Math.max(nodes[b + 10], influence * 0.3)
      }
    }
  }

  // ─── Update node positions ───
  function updateNodes(dt, now) {
    for (var i = 0; i < NODE_COUNT; i++) {
      var b = i * NS
      var ta = nodes[b + 9], ca = nodes[b + 8]
      if (Math.abs(ca - ta) > 0.001) nodes[b + 8] += (ta - ca) * 0.04
      if (nodes[b + 10] > 0) { nodes[b + 10] *= 0.97; if (nodes[b + 10] < 0.01) nodes[b + 10] = 0 }
      if (nodes[b + 11] > 0 && now >= nodes[b + 11]) { nodes[b + 10] = Math.min(1, nodes[b + 10] + 0.5); nodes[b + 11] = 0 }
      // Organic drift added to home target
      var phase = nodes[b + 13]
      var targetX = nodes[b + 2] + Math.sin(time * 0.25 + phase) * 2
      var targetY = nodes[b + 3] + Math.cos(time * 0.18 + phase * 1.3) * 2
      // Home spring
      nodes[b + 4] += (targetX - nodes[b]) * SPRING_K
      nodes[b + 5] += (targetY - nodes[b + 1]) * SPRING_K
      // Damping + integrate
      nodes[b + 4] *= DAMPING; nodes[b + 5] *= DAMPING
      nodes[b] += nodes[b + 4]; nodes[b + 1] += nodes[b + 5]
    }
  }

  // ─── Update particles ───
  function updateParticles(dt, now) {
    if (perfLevel >= 2) return
    var maxP = perfLevel === 1 ? Math.floor(particleCount / 2) : particleCount
    var converging = convergeActive > 0 && now - convergeActive < 1500
    for (var i = 0; i < maxP; i++) {
      var b = i * PS
      if (particles[b + 4] < 0.5) continue
      var ci = Math.floor(particles[b])
      if (ci >= connCount) { particles[b + 4] = 0; continue }
      var spd = particles[b + 2]; if (converging) spd *= 1.8
      particles[b + 1] += spd * particles[b + 3] * dt * 60
      if (particles[b + 1] > 1) { particles[b + 1] = 0; particles[b + 3] = Math.random() < 0.5 ? 1 : -1 }
      if (particles[b + 1] < 0) { particles[b + 1] = 1; particles[b + 3] = Math.random() < 0.5 ? 1 : -1 }
    }
  }

  // ─── Drawing ───
  function drawConnections() {
    ctx.lineWidth = 0.5
    for (var i = 0; i < connCount; i++) {
      var ba = connA[i] * NS, bb = connB[i] * NS
      var avgA = (nodes[ba + 8] + nodes[bb + 8]) * 0.5 * connAlpha[i]
      var lineA = avgA * 0.12 + (nodes[ba + 10] + nodes[bb + 10]) * 0.5 * 0.08
      if (lineA < 0.005) continue
      ctx.beginPath(); ctx.moveTo(nodes[ba], nodes[ba + 1]); ctx.lineTo(nodes[bb], nodes[bb + 1])
      ctx.strokeStyle = rgba(lineA); ctx.stroke()
    }
  }

  function drawParticles() {
    if (perfLevel >= 2) return
    var maxP = perfLevel === 1 ? Math.floor(particleCount / 2) : particleCount
    for (var i = 0; i < maxP; i++) {
      var b = i * PS; if (particles[b + 4] < 0.5) continue
      var ci = Math.floor(particles[b]); if (ci >= connCount) continue
      var ba = connA[ci] * NS, bb = connB[ci] * NS
      var nA = nodes[ba + 8], nB = nodes[bb + 8]; if (nA < 0.05 || nB < 0.05) continue
      var t = particles[b + 1]
      var px = nodes[ba] + (nodes[bb] - nodes[ba]) * t
      var py = nodes[ba + 1] + (nodes[bb + 1] - nodes[ba + 1]) * t
      var pA = particles[b + 5] * Math.min(nA, nB) * 0.8
      ctx.beginPath(); ctx.arc(px, py, 1.5, 0, Math.PI * 2); ctx.fillStyle = rgba(pA * 0.3); ctx.fill()
      ctx.beginPath(); ctx.arc(px, py, 0.8, 0, Math.PI * 2); ctx.fillStyle = rgba(pA); ctx.fill()
    }
  }

  function drawNodes() {
    for (var tier = 0; tier <= 2; tier++) {
      for (var i = 0; i < NODE_COUNT; i++) {
        var b = i * NS; if (nodes[b + 6] !== tier) continue
        var alpha = nodes[b + 8]; if (alpha < 0.01) continue
        var glow = nodes[b + 10], r = nodes[b + 7]
        var x = nodes[b], y = nodes[b + 1]
        var drawA = alpha * (0.5 + glow * 0.5)
        if (glow > 0.08 || tier >= 1) {
          var glowR = r * (tier === 2 ? 5 : tier === 1 ? 3.5 : 2.5)
          var grad = ctx.createRadialGradient(x, y, 0, x, y, glowR)
          var bloomA = drawA * (tier === 2 ? 0.2 : tier === 1 ? 0.12 : 0.08) + glow * 0.15
          grad.addColorStop(0, rgba(Math.min(0.4, bloomA))); grad.addColorStop(1, rgba(0))
          ctx.beginPath(); ctx.arc(x, y, glowR, 0, Math.PI * 2); ctx.fillStyle = grad; ctx.fill()
        }
        ctx.beginPath(); ctx.arc(x, y, r, 0, Math.PI * 2); ctx.fillStyle = rgba(drawA); ctx.fill()
      }
    }
  }

  // ─── Main loop ───
  function tick() {
    if (!visible) { animId = 0; return }
    animId = requestAnimationFrame(tick)
    var now = performance.now()
    var dt = lastFrame ? Math.min((now - lastFrame) / 1000, 0.05) : 0.016
    lastFrame = now; time += dt
    var fps = dt > 0 ? 1 / dt : 60
    if (fps < 45) fpsLowCount++; else fpsLowCount = Math.max(0, fpsLowCount - 2)
    if (fpsLowCount > 60 && perfLevel < 2) perfLevel = 2
    else if (fpsLowCount > 30 && perfLevel < 1) perfLevel = 1
    if (fpsLowCount === 0 && perfLevel > 0) perfLevel = Math.max(0, perfLevel - 1)

    updateBuild(now); updateFellowPulse(now); updateConverge(now)
    updateCursor(); updateSprings(); updateNodes(dt, now); updateParticles(dt, now)
    ctx.clearRect(0, 0, W, H); drawConnections(); drawParticles(); drawNodes()
  }

  // ─── Visibility observer ───
  var obs = new IntersectionObserver(function(entries) {
    for (var i = 0; i < entries.length; i++) {
      if (entries[i].isIntersecting) {
        visible = true
        if (buildPhase === 0) { buildPhase = 1; buildStart = performance.now() }
        if (!animId) tick()
      } else { visible = false }
    }
  }, { threshold: 0.1 })
  obs.observe(hero)

  // ─── Mouse events ───
  function onMouseMove(e) {
    var rect = canvas.getBoundingClientRect()
    mouseX = (e.clientX - rect.left) * (W / rect.width)
    mouseY = (e.clientY - rect.top) * (H / rect.height)
  }
  function onMouseLeave() { mouseX = -9999; mouseY = -9999 }
  hero.addEventListener('mousemove', onMouseMove)
  hero.addEventListener('mouseleave', onMouseLeave)

  // ─── Touch events ───
  function onTouchMove(e) {
    if (e.touches.length > 0) {
      var rect = canvas.getBoundingClientRect()
      mouseX = (e.touches[0].clientX - rect.left) * (W / rect.width)
      mouseY = (e.touches[0].clientY - rect.top) * (H / rect.height)
    }
  }
  function onTouchEnd() { mouseX = -9999; mouseY = -9999 }
  hero.addEventListener('touchmove', onTouchMove, { passive: true })
  hero.addEventListener('touchend', onTouchEnd)

  window.addEventListener('resize', debouncedResize)

  _meshCleanup = function() {
    if (animId) cancelAnimationFrame(animId); animId = 0
    hero.removeEventListener('mousemove', onMouseMove)
    hero.removeEventListener('mouseleave', onMouseLeave)
    hero.removeEventListener('touchmove', onTouchMove)
    hero.removeEventListener('touchend', onTouchEnd)
    window.removeEventListener('resize', debouncedResize)
    if (obs) obs.disconnect()
  }
}

initNetworkMesh()
document.addEventListener('astro:page-load', initNetworkMesh)
</script>
