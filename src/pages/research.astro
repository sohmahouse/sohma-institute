---
import PortalLayout from '../layouts/PortalLayout.astro'
---

<PortalLayout
  title="Research — Sohma Institute"
  description="Developing methodologies appropriate to the complexity of traditional medicine interventions. Six research programs, a clinical translation pipeline, and an ethics architecture built on Indigenous Data Sovereignty."
>
  <article class="research-page">

    <!-- HERO -->
    <header class="research-hero">
      <div class="hero-inner">
        <div class="hero-columns">
          <div class="hero-left">
            <div class="section-label">Research Programs</div>
            <h1 class="hero-title">Research That Preserves What It Studies</h1>
            <p class="hero-lead">Developing research methodologies appropriate to the complexity of traditional medicine interventions — whole-systems design, adaptive protocols, and practice-based evidence networks.</p>
          </div>
          <div class="hero-right">
            <div class="hero-partner">
              <div class="hero-partner-header">
                <span class="hero-partner-label">Research Partnership</span>
                <div class="hero-partner-line"></div>
              </div>
              <svg class="hero-partner-logo" xmlns="http://www.w3.org/2000/svg" width="103" height="47" viewBox="0 0 103 47" role="img" aria-label="James Cook University">
                <g fill-rule="nonzero">
                  <!-- Sun / star -->
                  <path class="jcu-sun" fill="#FFF" d="M15.82 8.63a2.349 2.349 0 0 0 0-.768l-.064-.257c-.042-.235-.042-.427-.042-.64 0-.214.063-.492.148-.62-.211-.043-.507.235-.655.47-.105.17-.19.32-.253.513-.021.064-.043.15-.064.213a2.14 2.14 0 0 1-.359.599c-.19.213-.422.384-.633.555a5.057 5.057 0 0 1 1.71.726c.085-.277.17-.512.212-.79zM9.906 7.648c.042.064.063.128.105.192.085.214.148.45.17.663.02.277-.022.577-.064.854a4.688 4.688 0 0 1 1.71-.705c-.105-.213-.21-.448-.358-.662a3.394 3.394 0 0 0-.55-.555c-.063-.043-.147-.086-.21-.15a3.182 3.182 0 0 1-.486-.427c-.148-.171-.296-.385-.338-.556-.17.128-.19.534-.148.812.042.192.084.363.169.534zM13.708 8.61L12.863.064l-.845 8.546c.274-.043.549-.086.845-.086.274.021.57.043.845.086zM17.002 10.746l1.627-2.927-2.894 1.645c.486.342.93.77 1.267 1.282zM9.97 9.443L7.076 7.798l1.626 2.927a5.583 5.583 0 0 1 1.267-1.282zM18.989 11.686c.042-.064.084-.15.148-.214.126-.192.274-.342.422-.491.169-.15.38-.3.55-.342-.128-.17-.529-.192-.803-.15-.19.043-.36.086-.528.171-.064.043-.127.065-.19.107-.19.086-.444.15-.655.171-.275.022-.57-.021-.845-.064.338.513.57 1.09.697 1.73.211-.106.443-.213.655-.363.21-.15.4-.341.549-.555zM7.857 12.818l-4.604.833 4.604.834a5.533 5.533 0 0 1 0-1.667zM22.452 13.651l-4.626-.833c.042.278.085.556.085.833 0 .278-.022.556-.085.834l4.626-.834zM7.118 10.661a1.05 1.05 0 0 1-.254.042c-.232.043-.422.043-.654.043-.212 0-.465-.064-.613-.15-.042.214.232.513.465.663.148.106.317.192.507.256.063.021.147.043.21.064.212.064.423.214.571.363.211.193.38.428.55.641.126-.62.38-1.196.717-1.709a3.538 3.538 0 0 0-.718-.214 2.394 2.394 0 0 0-.781 0zM12.842 9.4c-2.303 0-4.182 1.901-4.182 4.251 0 .214.02.428.042.62.38-.128.74-.256 1.035-.449.781-.448 1.88-.726 3.126-.726 1.225 0 2.344.278 3.126.726.295.171.654.32 1.035.449.02-.214.042-.406.042-.62-.021-2.35-1.901-4.251-4.224-4.251z"/>
                  <!-- Shield / waves -->
                  <path class="jcu-shield" fill="#FFF" d="M22.198 26.448c-.781.449-1.88.727-3.126.727-1.225 0-2.344-.278-3.126-.727-.781-.448-1.88-.726-3.126-.726-1.225 0-2.344.278-3.125.726-.782.449-1.88.727-3.126.727-1.225 0-2.345-.278-3.105-.727-.782-.448-1.88-.726-3.126-.726H0v2.905c0 .449.021.876.042 1.282h.296c1.225 0 2.344.278 3.126.726.781.45 1.88.727 3.105.727s2.344-.278 3.126-.727c.781-.448 1.88-.726 3.125-.726 1.225 0 2.345.278 3.126.726.782.45 1.88.727 3.126.727 1.225 0 2.345-.278 3.126-.727.782-.448 1.88-.726 3.105-.726h.296c.02-.427.042-.833.042-1.282V25.7h-.338c-1.225 0-2.323.3-3.105.748M19.093 35.592c-1.225 0-2.344-.278-3.126-.727-.781-.448-1.88-.726-3.125-.726-1.225 0-2.345.278-3.126.726-.782.45-1.88.727-3.126.727-1.225 0-2.345-.278-3.105-.727-.697-.405-1.647-.662-2.704-.726a15.794 15.794 0 0 0 2.303 4.721c.148.065.274.129.401.193.781.448 1.88.726 3.105.726s2.344-.278 3.126-.726c.781-.449 1.88-.748 3.126-.748 1.225 0 2.344.278 3.125.748.782.448 1.88.726 3.126.726 1.225 0 2.345-.278 3.126-.726.127-.064.254-.15.402-.193a15.794 15.794 0 0 0 2.302-4.72c-1.077.042-2.028.32-2.704.725-.802.45-1.9.727-3.126.727M15.967 43.261c-.781-.448-1.88-.726-3.125-.726-1.225 0-2.345.278-3.126.726-.38.214-.824.385-1.331.513 1.795 1.218 3.443 2.094 4.435 2.948 1.014-.854 2.662-1.73 4.436-2.948a5.81 5.81 0 0 1-1.289-.513M22.198 18.03c-.781.45-1.88.749-3.126.749-1.225 0-2.344-.278-3.126-.748-.781-.449-1.88-.726-3.126-.726-1.225 0-2.344.277-3.125.726-.782.449-1.88.748-3.126.748-1.225 0-2.345-.278-3.105-.748-.782-.449-1.88-.726-3.126-.726H0v4.208h.338c1.225 0 2.344.278 3.126.727.781.448 1.88.726 3.105.726s2.344-.278 3.126-.726c.781-.45 1.88-.727 3.125-.727 1.225 0 2.345.278 3.126.727.782.448 1.88.726 3.126.726 1.225 0 2.345-.278 3.126-.726.782-.45 1.88-.727 3.105-.727h.338v-4.208h-.338c-1.225 0-2.323.277-3.105.726"/>
                  <!-- Text -->
                  <path class="jcu-text" fill="#FFF" d="M31.196 19.27c0-1.282-.021-1.517-1.542-1.73v-.171h3.97v.17c-1.393.193-1.414.535-1.414 1.731v4.187c.02 2.265-.254 2.778-2.767 3.867l-.085-.192c1.69-.812 1.838-2.072 1.838-4.166V19.27zM36.856 18.394l-1.077 3.034h2.281l-1.204-3.034zm-1.288 3.59c-.19.576-.697 1.794-.697 2.37 0 .706.802.706 1.31.791v.17h-3.169v-.17c1.035-.278 1.14-.513 1.5-1.431l1.31-3.44.696-1.901c.106-.3.254-.577.127-.812.317-.128.591-.342.845-.641l2.534 6.858c.317.854.507 1.196 1.436 1.367v.17h-3.4v-.17c.401-.085.887-.214.887-.748 0-.491-.443-1.58-.74-2.414h-2.64zM47.058 23.607l2.09-4.657c.296-.641.444-1.218.19-1.41l.022-.193h2.534v.171c-.739.15-1.183.427-1.14 1.26l.253 4.252c.127 1.624.127 1.88 1.352 2.094v.17h-3.802v-.17c.887-.15 1.457-.257 1.394-1.282l-.317-5.106-2.936 6.559h-.126l-2.746-6.281h-.021a75.064 75.064 0 0 0-.36 4.892c-.02.449-.02.983 1.395 1.218v.17h-3.232v-.17c1.035-.171 1.14-.684 1.289-1.624l.422-3.29.148-1.58c.063-.77-.591-1.048-1.267-1.09v-.171h2.492l.021.128c-.253.278.063.961.148 1.153l2.197 4.957zM52.845 25.124c1.394-.193 1.394-.534 1.436-1.752v-4.123c-.042-1.197-.042-1.56-1.436-1.73v-.172h6.21l-.149 1.795h-.169c-.084-1.517-1.161-1.517-2.323-1.517h-1.12v3.333H56.5c.866 0 1.52-.064 1.647-1.068h.169v2.606h-.169c-.148-1.026-.781-1.047-1.647-1.047h-1.204v1.923c0 .683-.17 1.645 1.732 1.645 1.457 0 2.175-.556 2.47-2.03h.17a7.612 7.612 0 0 1-.402 2.308h-6.42v-.171zM64.968 19.42h-.19c-.19-.94-.486-1.86-1.626-1.86-.74 0-1.352.514-1.352 1.283 0 2.03 3.633 1.944 3.633 4.315 0 1.517-1.479 2.286-2.81 2.286a3.811 3.811 0 0 1-2.027-.598l-.338-1.987h.211c.296 1.132 1.056 2.222 2.345 2.222.845 0 1.52-.513 1.52-1.431 0-2.073-3.527-1.902-3.527-4.23 0-1.368 1.33-2.222 2.577-2.222.591 0 1.183.17 1.69.448l-.106 1.774zM75.19 19.761h-.168c-.211-1.324-.993-2.264-2.366-2.264-2.112 0-3.316 1.752-3.316 3.76 0 2.307 1.753 3.91 3.422 3.91 1.52 0 2.112-1.112 2.64-2.393l.169.064c-.148.705-.36 1.41-.634 2.093-.739.364-1.542.513-2.365.513-2.408 0-4.562-1.41-4.562-4.038 0-2.072 1.605-4.187 4.646-4.187.887 0 1.774.171 2.535.641v1.901zM77.493 21.043c0 1.816.95 4.123 3.02 4.123 1.901 0 2.746-1.965 2.746-3.631-.042-2.073-1.225-4.038-3-4.038-1.964 0-2.766 1.965-2.766 3.546m7.118.278c0 2.52-1.796 4.123-4.225 4.123-2.428 0-4.224-1.602-4.224-4.123 0-2.5 1.796-4.102 4.224-4.102 2.957 0 4.225 2.03 4.225 4.102M86.786 21.043c0 1.816.95 4.123 3.02 4.123 1.901 0 2.746-1.965 2.746-3.631-.042-2.073-1.225-4.038-2.999-4.038-1.985 0-2.767 1.965-2.767 3.546m7.118.278c0 2.52-1.795 4.123-4.224 4.123-2.43 0-4.224-1.602-4.224-4.123 0-2.5 1.795-4.102 4.224-4.102 2.936 0 4.224 2.03 4.224 4.102M101.782 17.347v.171c-1.31.15-2.197 1.282-3.041 2.18l-1.078 1.174 2.345 2.628c.697.79 1.542 1.474 2.555 1.773l-.063.171c-2.006-.17-2.323-.214-3.421-1.431l-2.366-2.585 1.859-2.051c1.204-1.389.971-1.773.21-1.837v-.171h3v-.022zm-5.217 6.046c.042 1.197.042 1.56 1.542 1.752v.17h-3.992v-.17c1.394-.192 1.394-.534 1.436-1.752V19.27c-.042-1.196-.042-1.56-1.436-1.73v-.171h3.675v.17c-1.183.193-1.183.535-1.225 1.731v4.123zM38.694 28.328v.171c-1.056.107-1.12.77-1.162 2.307l-.063 2.564c-.043 1.517-.676 3.034-3.232 3.034-3.59 0-3.21-2.628-3.21-3.547V30.23c-.043-1.197-.043-1.56-1.437-1.752v-.171h3.992v.17c-1.52.214-1.541.45-1.541 1.753v2.392c0 .214-.38 3.248 2.788 3.248 2.492 0 2.26-2.415 2.26-3.825v-1.217c0-1.474-.106-2.158-1.732-2.308v-.17h3.337v-.022zM46.74 34.438l-.063-4.273c-.02-1.11-.316-1.43-1.626-1.666v-.17h3.147v.17c-.803.107-.95.556-1.035 1.303-.169 1.282-.105 4.102-.042 6.644l-.148.043c-1.859-2.2-3.907-4.251-5.85-6.388v2.158c0 2.906-.064 3.504 1.605 3.824v.171h-3.464v-.15c1.563-.17 1.5-1.239 1.5-3.888v-1.751c0-1.175-.19-1.624-1.648-1.945v-.17h1.901l5.724 6.088zM51.155 34.353c.042 1.196.042 1.56 1.436 1.73v.171h-3.886v-.15c1.394-.192 1.394-.534 1.436-1.73v-4.123c-.042-1.196-.042-1.56-1.436-1.752v-.17h3.886v.17c-1.394.192-1.394.534-1.436 1.752v4.102zM61.525 28.328v.171c-1.077.086-1.415 1.026-2.133 2.713l-2.217 5.32h-.17l-2.618-6.324c-.338-.854-.613-1.602-1.648-1.709v-.17h3.654v.17c-1.626.171-1.098 1.09-.803 1.837l1.86 4.508 1.372-3.311c.993-2.393 1.183-2.778-.57-3.034v-.17h3.273zM61.61 36.105c1.394-.193 1.394-.535 1.436-1.73V30.25c-.042-1.196-.042-1.56-1.436-1.752v-.17h6.21l-.148 1.794h-.17c-.084-1.517-1.161-1.517-2.323-1.517h-1.12v3.333h1.205c.866 0 1.52-.064 1.647-1.069h.17v2.607h-.17c-.148-1.026-.781-1.047-1.647-1.047H64.06v1.923c0 .683-.169 1.645 1.732 1.645 1.457 0 2.175-.556 2.45-2.03h.169a7.612 7.612 0 0 1-.401 2.307h-6.421v-.17h.02zM71.326 32.28c1.119-.02 2.407-.534 2.407-1.815 0-1.368-1.182-1.923-2.407-1.902v3.717zm-1.014-1.538c0-1.794-.064-2.05-1.352-2.179v-.17l2.81-.086c2.914-.086 3.146 1.346 3.146 1.901 0 .983-.591 1.538-1.436 1.923l.063.085c.887 1.581 2.007 3.59 3.908 3.995l-.043.171c-1.225-.064-2.133-.021-2.788-.726a10.359 10.359 0 0 1-1.605-2.329c-.464-.961-.887-.683-1.69-.833v1.88c0 1.282.022 1.517 1.606 1.73v.171h-4.055v-.17c1.394-.193 1.394-.535 1.436-1.73v-3.633zM81.823 30.38h-.19c-.19-.94-.486-1.86-1.627-1.86-.739 0-1.351.513-1.351 1.282 0 2.03 3.632 1.944 3.632 4.316 0 1.517-1.478 2.286-2.809 2.286a3.811 3.811 0 0 1-2.027-.599l-.338-1.986h.21c.297 1.132 1.057 2.221 2.345 2.221.845 0 1.521-.512 1.521-1.43 0-2.073-3.527-1.902-3.527-4.23 0-1.368 1.33-2.223 2.577-2.223.591 0 1.182.171 1.69.449l-.106 1.773zM85.202 34.353c.042 1.196.042 1.56 1.436 1.73v.171h-3.886v-.15c1.394-.192 1.394-.534 1.436-1.73v-4.123c-.042-1.196-.042-1.56-1.436-1.752v-.17h3.886v.17c-1.394.192-1.394.534-1.436 1.752v4.102zM94.284 27.965h.085l.169 2.18-.17.042c-.4-1.453-1.034-1.517-2.365-1.517h-.697v5.405c0 1.453.063 1.837 1.626 2.03v.17h-4.245v-.17c1.542-.193 1.626-.577 1.626-2.03V28.67h-.697c-1.33 0-1.964.064-2.365 1.517l-.17-.043.17-2.179h.084l.106.107c.296.278.338.256.718.256h5.301c.38 0 .423.022.718-.256l.106-.107zM102.162 28.328v.171c-1.014.086-1.5.641-1.985 1.496l-1.373 2.734v1.325c.021 1.346.042 1.816 1.52 2.05v.171h-4.076v-.17c1.479-.235 1.5-.705 1.521-2.051v-.94l-1.204-2.65c-.443-.982-.76-1.815-1.922-1.944v-.17h3.19v.17c-.951.129-.824.513-.444 1.325l1.162 2.52 1.013-1.922c.718-1.346.634-1.794-.38-1.923v-.17h2.978v-.022zM30.963 38.582h70.46v1h-70.46zM33.371 40.869h.908l2.472 5.704h-1.057l-.57-1.368h-2.64l-.57 1.368H30.9l2.471-5.704zm1.394 3.44l-.971-2.265-.95 2.264h1.921zM37.088 44.159V40.89h.993v3.226c0 1.047.528 1.602 1.415 1.602.866 0 1.415-.534 1.415-1.56V40.89h.993v3.205c0 1.687-.95 2.542-2.408 2.542-1.478.021-2.408-.833-2.408-2.478zM42.453 45.74l.592-.705c.528.47 1.077.726 1.774.726.612 0 .992-.3.992-.705v-.021c0-.406-.232-.62-1.267-.855-1.183-.3-1.858-.64-1.858-1.688v-.021c0-.961.802-1.645 1.9-1.645.824 0 1.458.256 2.028.705l-.528.748c-.507-.385-1.014-.577-1.52-.577-.571 0-.909.299-.909.662v.021c0 .428.254.641 1.33.898 1.183.299 1.796.726 1.796 1.666v.021c0 1.069-.824 1.688-2.007 1.688a3.587 3.587 0 0 1-2.323-.918zM49.085 41.83h-1.774v-.919h4.541v.919h-1.774v4.743h-.993V41.83zM52.74 40.89h2.491c.697 0 1.247.214 1.606.555.295.3.464.727.464 1.218v.022c0 .94-.549 1.495-1.33 1.709l1.52 2.136H56.33l-1.373-1.965h-1.225v1.965h-.993v-5.64zm2.407 2.82c.697 0 1.162-.363 1.162-.94v-.021c0-.599-.423-.94-1.162-.94H53.71v1.901h1.436zM60.997 40.869h.909l2.47 5.704h-1.034l-.57-1.368h-2.64l-.57 1.368h-1.015l2.45-5.704zm1.394 3.44l-.971-2.265-.95 2.264h1.921zM65.37 40.89h.992v4.764h2.936v.897h-3.929V40.89zM70.227 40.89h.993v5.683h-.993zM74.642 40.869h.908l2.47 5.704h-1.034l-.57-1.368h-2.64l-.57 1.368h-1.014l2.45-5.704zm1.394 3.44l-.972-2.265-.95 2.264h1.922z"/>
                </g>
              </svg>
              <div class="hero-partner-pillars">
                <div class="hero-partner-pillar">
                  <span class="pillar-icon">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M22 10v6M2 10l10-5 10 5-10 5z"/><path d="M6 12v5c3 3 9 3 12 0v-5"/></svg>
                  </span>
                  <span>Applied Research Pipelines</span>
                </div>
                <div class="hero-partner-pillar">
                  <span class="pillar-icon">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
                  </span>
                  <span>CPD Pathways</span>
                </div>
                <div class="hero-partner-pillar">
                  <span class="pillar-icon">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
                  </span>
                  <span>Clinical Governance</span>
                </div>
              </div>
              <p class="hero-partner-desc">Anchored in Tropical North Queensland — embedding clinical research and practitioner training within a living healthcare model.</p>
            </div>
          </div>
        </div>
      </div>
    </header>


    <!-- RESEARCH PROGRAMS -->
    <section class="programs-section" id="programs">
      <div class="programs-filters" id="programs-filters">
        <button class="program-filter active" data-division="All" type="button">
          All
          <span class="program-filter-count">6</span>
        </button>
        <button class="program-filter" data-division="Division I" type="button">
          Division I
          <span class="program-filter-count">2</span>
        </button>
        <button class="program-filter" data-division="Division II" type="button">
          Division II
          <span class="program-filter-count">1</span>
        </button>
        <button class="program-filter" data-division="Division V" type="button">
          Division V
          <span class="program-filter-count">1</span>
        </button>
        <button class="program-filter" data-division="Cross-Divisional" type="button">
          Cross-Divisional
          <span class="program-filter-count">2</span>
        </button>
      </div>

      <div class="programs-wrap">
        <div class="programs-grid">
          <div class="program-card" data-division="Division I">
            <span class="program-num">01</span>
            <h3 class="program-title">Phytochemical Synergy Mapping</h3>
            <p class="program-subtitle">Network pharmacology analysis of traditional formulae to identify synergistic mechanisms that single-compound analysis cannot detect.</p>

            <div class="program-accordion">Computational and empirical investigation of multi-constituent botanical preparations. The signature deliverable is the first open-access database mapping traditional herbal combinations to validated network pharmacology profiles.</div>
            <div class="program-footer">
              <span class="program-division">Division I</span>
              <span class="program-status status-active">Active</span>
            </div>
          </div>

          <div class="program-card" data-division="Division II">
            <span class="program-num">02</span>
            <h3 class="program-title">Cannabis Clinical Outcomes Registry</h3>
            <p class="program-subtitle">Practice-based evidence network aggregating clinical outcomes from Sohma House and partner prescriber sites.</p>

            <div class="program-accordion">Standardised outcome measures across condition categories. Real-world evidence generation at scale — the kind of data the TGA needs for regulatory pathway development. Feeds directly into TGA submissions and clinical protocol refinement.</div>
            <div class="program-footer">
              <span class="program-division">Division II</span>
              <span class="program-status status-active">Active</span>
            </div>
          </div>

          <div class="program-card" data-division="Cross-Divisional">
            <span class="program-num">03</span>
            <h3 class="program-title">Whole-Systems Research Design</h3>
            <p class="program-subtitle">Research about how to do research. Methodological innovation for complex, multi-component interventions.</p>

            <div class="program-accordion">Preserve intervention complexity rather than reducing it to fit existing trial designs. The contribution is a published methodology framework that other institutions can adopt — proof that rigorous evidence doesn't require destroying the thing you're studying.</div>
            <div class="program-footer">
              <span class="program-division">Cross-Divisional</span>
              <span class="program-status design">In Design</span>
            </div>
          </div>

          <div class="program-card" data-division="Division I">
            <span class="program-num">04</span>
            <h3 class="program-title">Tropical &amp; Indigenous Pharmacopoeia</h3>
            <p class="program-subtitle">Documentation and clinical validation of Far North Queensland botanical resources under Indigenous Data Sovereignty.</p>

            <div class="program-accordion">Supporting communities to document and validate their own traditions using modern analytical tools, with community ownership of all data and outputs. Operates under AIATSIS guidelines and community-controlled data governance.</div>
            <div class="program-footer">
              <span class="program-division">Division I</span>
              <span class="program-status design">In Design</span>
            </div>
          </div>

          <div class="program-card" data-division="Division V">
            <span class="program-num">05</span>
            <h3 class="program-title">Consciousness &amp; Somatic Therapeutics</h3>
            <p class="program-subtitle">Clinical investigation of meditation, breathwork, and somatic practices as measurable interventions.</p>

            <div class="program-accordion">Standardised dosing for practices historically treated as unmeasurable. Neuroimaging partnerships to establish biomarker correlates. Moving these interventions from "wellness" into the same evidentiary category as pharmacological treatments.</div>
            <div class="program-footer">
              <span class="program-division">Division V</span>
              <span class="program-status seeking">Seeking Funding</span>
            </div>
          </div>

          <div class="program-card" data-division="Cross-Divisional">
            <span class="program-num">06</span>
            <h3 class="program-title">AI-Augmented Clinical Decision Support</h3>
            <p class="program-subtitle">Machine learning models trained on traditional medicine diagnostic frameworks.</p>

            <div class="program-accordion">Constitutional classification systems, pattern recognition methodologies, and multi-target therapeutic logic. Augmenting clinical reasoning, not replacing it — surfacing pattern matches a human clinician might miss.</div>
            <div class="program-footer">
              <span class="program-division">Cross-Divisional</span>
              <span class="program-status design">In Design</span>
            </div>
          </div>
        </div>

      </div>
    </section>


    <!-- CLINICAL TRANSLATION PIPELINE -->
    <section class="pipeline-section" id="pipeline">
      <canvas id="pipeline-sparks"></canvas>
      <div class="spiral-scroll-outer" id="spiral-scroll-outer">
        <div class="spiral-scroll-sticky">
          <div class="spiral-sidebar">
            <h2 class="section-heading">Clinical Translation Pipeline</h2>
            <div class="pipeline-intro">
              <p class="pipeline-question">Every funder and reviewer asks the same question — <em>so what happens with the research?</em></p>
              <p class="pipeline-answer">It goes straight into clinical practice through Sohma House and the practitioner network. Clinical data flows back into research refinement.</p>
              <p class="pipeline-close">The loop is closed by design.</p>
            </div>
            <div class="spiral-labels" id="spiral-labels">
              <div class="spiral-labels-track" id="spiral-labels-track">
              <div class="spiral-label" data-node="1">
                <span class="spiral-num">01</span>
                <h3>Research Hypothesis</h3>
                <p>Clinical questions are identified directly from practice-based observation, patient outcomes, and traditional knowledge systems. Practitioners surface the gaps that matter most — the questions that academic research hasn't asked yet.</p>
                <div class="stage-flow">
                  <span class="flow-before">Clinical observation</span>
                  <span class="flow-arrow"></span>
                  <span class="flow-after">Defined research question</span>
                </div>
              </div>
              <div class="spiral-label" data-node="2">
                <span class="spiral-num">02</span>
                <h3>Protocol Design</h3>
                <p>Whole-systems trial methodology designed to preserve intervention complexity rather than reduce it. Protocols account for multi-compound formulations, individualised dosing, and the practitioner-patient relationship as a variable.</p>
                <div class="stage-flow">
                  <span class="flow-before">Research question</span>
                  <span class="flow-arrow"></span>
                  <span class="flow-after">Trial-ready protocol</span>
                </div>
              </div>
              <div class="spiral-label" data-node="3">
                <span class="spiral-num">03</span>
                <h3>Clinical Pilot</h3>
                <p>Small-scale implementation through Sohma House and partner clinics. Real patients, real conditions, real-world constraints. Pilot data validates feasibility before scaling and identifies protocol adjustments early.</p>
                <div class="stage-flow">
                  <span class="flow-before">Protocol on paper</span>
                  <span class="flow-arrow"></span>
                  <span class="flow-after">Feasibility-validated pilot</span>
                </div>
              </div>
              <div class="spiral-label" data-node="4">
                <span class="spiral-num">04</span>
                <h3>Data Collection</h3>
                <p>Standardised outcome measurement across the practitioner network. Registry-level data aggregation captures what isolated trials cannot — longitudinal patterns, demographic variance, and combination therapy effects at scale.</p>
                <div class="stage-flow">
                  <span class="flow-before">Individual case data</span>
                  <span class="flow-arrow"></span>
                  <span class="flow-after">Network-wide dataset</span>
                </div>
              </div>
              <div class="spiral-label" data-node="5">
                <span class="spiral-num">05</span>
                <h3>Refinement</h3>
                <p>Protocols are adjusted based on clinical outcomes and practitioner feedback. This isn't a single revision — it's a continuous feedback loop where each iteration sharpens dosing, timing, and patient selection criteria.</p>
                <div class="stage-flow">
                  <span class="flow-before">Raw outcome data</span>
                  <span class="flow-arrow"></span>
                  <span class="flow-after">Optimised protocol</span>
                </div>
              </div>
              <div class="spiral-label" data-node="6">
                <span class="spiral-num">06</span>
                <h3>Validated Protocol</h3>
                <p>Peer-reviewed publication and formal evidence tier classification. Validated protocols carry clear confidence ratings so practitioners understand exactly what the evidence supports and where further research is needed.</p>
                <div class="stage-flow">
                  <span class="flow-before">Clinical evidence</span>
                  <span class="flow-arrow"></span>
                  <span class="flow-after">Peer-reviewed validation</span>
                </div>
              </div>
              <div class="spiral-label" data-node="7">
                <span class="spiral-num">07</span>
                <h3>Network Distribution</h3>
                <p>Validated protocols are distributed to credentialed practitioners through the network infrastructure. Training materials, dosing guides, and clinical decision support tools ensure consistent implementation across all partner sites.</p>
                <div class="stage-flow">
                  <span class="flow-before">Validated protocol</span>
                  <span class="flow-arrow"></span>
                  <span class="flow-after">Network-wide practice</span>
                </div>
              </div>
              </div>
            </div>
          </div>
          <div class="spiral-wrap">
            <canvas id="pipeline-canvas" class="pipeline-canvas" aria-hidden="true"></canvas>
          </div>
        </div>
      </div>

      <div class="tiers-layout">
        <div class="pipeline-feedback">
          <div class="pipeline-feedback-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>
          </div>
          <div class="pipeline-feedback-text">
            <span class="pipeline-feedback-label">Bidirectional by design</span>
            <p>Practitioners submit outcome data, adverse events, and protocol modification requests through a standardised reporting system. This data feeds directly into research program refinement.</p>
          </div>
        </div>
        <div class="tiers-stack">
          <div class="tier-card tier-green">
            <div class="tier-header">
              <span class="tier-letter green">A</span>
              <div class="tier-meta">
                <span class="tier-name">Validated</span>
                <span class="tier-access">All credentialed practitioners</span>
              </div>
            </div>
            <p>Completed clinical pilot, peer-reviewed publication, network-wide distribution.</p>
          </div>
          <div class="tier-card tier-warm">
            <div class="tier-header">
              <span class="tier-letter warm">B</span>
              <div class="tier-meta">
                <span class="tier-name">Provisional</span>
                <span class="tier-access">Associate & Fellow practitioners</span>
              </div>
            </div>
            <p>Active clinical pilot with preliminary data. Available under supervision framework.</p>
          </div>
          <div class="tier-card tier-neutral">
            <div class="tier-header">
              <span class="tier-letter neutral">C</span>
              <div class="tier-meta">
                <span class="tier-name">Investigational</span>
                <span class="tier-access">Research settings only</span>
              </div>
            </div>
            <p>Research design phase. Active data collection underway.</p>
          </div>
        </div>
      </div>
    </section>


    <!-- RESEARCH ETHICS -->
    <section class="ethics-section" id="ethics">
      <h2 class="section-heading">Research Ethics Architecture</h2>

      <div class="ethics-grid">
        <div class="ethics-card">
          <div class="ethics-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>
          </div>
          <h3>Indigenous Data Sovereignty</h3>
          <div class="ethics-field">
            <span class="ethics-field-label">Framework</span>
            <p>All research involving Indigenous knowledge systems operates under AIATSIS guidelines and community-controlled data governance. The Institute does not extract traditional knowledge — it supports communities to document and validate their own traditions, with community ownership of all data and outputs.</p>
          </div>
          <div class="ethics-field">
            <span class="ethics-field-label">Governance</span>
            <p>The <a href="/#about">Indigenous Advisory Council</a> holds veto authority over any research, curriculum, or publication involving Indigenous knowledge systems. This authority is constitutionally mandated, not advisory.</p>
          </div>
        </div>
        <div class="ethics-card">
          <div class="ethics-icon">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
          </div>
          <h3>Open Access Commitment</h3>
          <div class="ethics-field">
            <span class="ethics-field-label">Position</span>
            <p>All Institute-generated research is published under open access licences. Traditional medicine knowledge was never proprietary. It emerged from communities, was refined through millennia of practice, and belongs to humanity. The Institute's role is translation and validation, not enclosure.</p>
          </div>
          <div class="ethics-field">
            <span class="ethics-field-label">Charter Prohibition</span>
            <p>Patent-seeking on traditional knowledge is explicitly prohibited in the Institute charter. This is a constitutional prohibition that cannot be overridden by management, the board, or future leadership.</p>
          </div>
        </div>
      </div>
    </section>



  </article>
</PortalLayout>

<style>
  .research-page {
    font-family: 'Manrope', sans-serif;
    color: var(--text-heading);
    padding: 0;
  }
  .research-page p { line-height: 1.8; margin: 0 0 1rem; }
  .research-page p:last-child { margin-bottom: 0; }
  .research-page h2, .research-page h3 { margin: 0 0 14px; }
  .research-page a { color: var(--accent-dark); text-decoration: none; }
  .research-page a:hover { color: var(--accent-darker-hover); }


  /* ═══════════ HERO ═══════════ */
  .research-hero {
    position: relative;
    max-width: none;
    margin: 0 -40px;
    padding: 0;
    background: var(--bg-hero);
  }

  .hero-inner {
    position: relative;
    z-index: 1;
    padding: 96px calc(2rem + 40px) 64px calc(1rem + 40px);
  }

  .hero-columns {
    display: grid;
    grid-template-columns: 1fr 260px;
    gap: 3rem;
    align-items: start;
  }

  .hero-left {
    min-width: 0;
  }

  .hero-right {
    display: flex;
    flex-direction: column;
    gap: 2.5rem;
    padding-top: 0.25rem;
  }

  .hero-partner {
    display: flex;
    flex-direction: column;
    gap: 16px;
    border: 1px solid var(--border-light);
    border-radius: 6px;
    padding: 24px;
    background: var(--bg-card);
  }

  .hero-partner-header {
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .hero-partner-label {
    font-family: 'Manrope', sans-serif;
    font-size: 0.5625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--accent);
    white-space: nowrap;
  }

  .hero-partner-line {
    flex: 1;
    height: 1px;
    background: var(--border-light);
  }

  .hero-partner-logo {
    width: 120px;
    height: auto;
    align-self: center;
    overflow: visible;
  }

  /* Light mode: invert white SVG to black */
  .jcu-shield,
  .jcu-text {
    fill: #222;
    opacity: 0.5;
    transition: opacity 0.6s ease;
  }
  .jcu-sun {
    fill: #222;
    opacity: 0;
    transition: none;
  }

  /* Dark mode: keep white */
  :global([data-theme="dark"]) .jcu-shield,
  :global([data-theme="dark"]) .jcu-text {
    fill: #fff;
    opacity: 0.5;
  }
  :global([data-theme="dark"]) .jcu-sun {
    fill: #fff;
    opacity: 0;
  }

  /* Sun lights up — filament flicker then catch */
  .hero-partner-logo.logo-glow .jcu-sun {
    animation: sunFlicker 3s linear 0s forwards;
  }
  .hero-partner-logo.logo-glow .jcu-shield,
  .hero-partner-logo.logo-glow .jcu-text {
    opacity: 0.6;
  }

  @keyframes sunFlicker {
    /* dark */
    0%    { opacity: 0;    fill: #222; filter: none; }
    /* first flicker — brief */
    6%    { opacity: 0.35; fill: #9a7520; filter: drop-shadow(0 0 3px rgba(180,130,30,0.3)); }
    9%    { opacity: 0.05; fill: #4a3810; filter: none; }
    /* second flicker — a touch stronger */
    16%   { opacity: 0.5;  fill: #b8941e; filter: drop-shadow(0 0 4px rgba(200,150,30,0.4)); }
    19%   { opacity: 0.08; fill: #4a3810; filter: none; }
    /* third flicker — almost catches */
    27%   { opacity: 0.7;  fill: #c8a020; filter: drop-shadow(0 0 5px rgba(210,160,30,0.5)); }
    31%   { opacity: 0.15; fill: #6a5018; filter: none; }
    /* catches — warm up */
    40%   { opacity: 0.6;  fill: #b89020; filter: drop-shadow(0 0 4px rgba(200,150,30,0.4)); }
    55%   { opacity: 0.85; fill: #d4a017; filter: drop-shadow(0 0 6px rgba(212,160,23,0.6)); }
    /* full brightness surge */
    72%   { opacity: 1;    fill: #f0c040; filter: drop-shadow(0 0 12px rgba(240,192,64,0.8)); }
    /* settle into warm glow */
    100%  { opacity: 1;    fill: #d4a017; filter: drop-shadow(0 0 6px rgba(212,160,23,0.45)); }
  }

  :global([data-theme="dark"]) .hero-partner-logo.logo-glow .jcu-sun {
    animation: sunFlickerDark 3s linear 0s forwards;
  }

  @keyframes sunFlickerDark {
    0%    { opacity: 0;    fill: #fff;    filter: none; }
    6%    { opacity: 0.4;  fill: #b89428; filter: drop-shadow(0 0 4px rgba(200,160,40,0.4)); }
    9%    { opacity: 0.06; fill: #5a4818; filter: none; }
    16%   { opacity: 0.55; fill: #c8a830; filter: drop-shadow(0 0 5px rgba(220,170,50,0.5)); }
    19%   { opacity: 0.08; fill: #5a4818; filter: none; }
    27%   { opacity: 0.75; fill: #d8b030; filter: drop-shadow(0 0 6px rgba(230,180,50,0.6)); }
    31%   { opacity: 0.15; fill: #7a6020; filter: none; }
    40%   { opacity: 0.65; fill: #c8a828; filter: drop-shadow(0 0 5px rgba(220,170,40,0.5)); }
    55%   { opacity: 0.9;  fill: #e8b830; filter: drop-shadow(0 0 8px rgba(232,184,48,0.7)); }
    72%   { opacity: 1;    fill: #ffd54f; filter: drop-shadow(0 0 14px rgba(255,213,79,0.85)); }
    100%  { opacity: 1;    fill: #e8b830; filter: drop-shadow(0 0 8px rgba(232,184,48,0.5)); }
  }

  .hero-partner-pillars {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-top: 6px;
  }

  .hero-partner-pillar {
    display: flex;
    align-items: center;
    gap: 10px;
    font-family: 'Manrope', sans-serif;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-secondary);
  }

  .pillar-icon {
    color: var(--accent);
    opacity: 0.6;
    flex-shrink: 0;
    display: flex;
  }

  .hero-partner-desc {
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 400;
    color: var(--text-tertiary);
    line-height: 1.6;
    margin: 0;
    padding-top: 14px;
    margin-top: 4px;
    border-top: 1px solid var(--border-light);
  }

  .section-label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--accent-dark);
    margin-bottom: 2rem;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--accent-line);
  }

  .hero-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2.5rem, 5vw, 4.75rem);
    font-weight: 500;
    line-height: 1.1;
    letter-spacing: -0.01em;
    color: var(--text-heading);
    max-width: 700px;
    margin: 0 0 24px;
  }

  .hero-lead {
    font-size: 1.0625rem;
    color: var(--text-secondary);
    line-height: 1.65;
    max-width: 80%;
    padding-left: 1.5rem;
    margin-bottom: 2rem;
  }

  .hero-cta-row {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding-left: 0;
    margin-top: 3rem;
  }

  .research-page .hero-cta-primary {
    display: inline-block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    color: var(--text-heading);
    background: var(--accent-dark);
    padding: 12px 28px;
    transition: background 0.15s;
  }
  .research-page .hero-cta-primary:hover { background: var(--accent-darker-hover); color: var(--text-heading); }

  .research-page .hero-cta-secondary {
    display: inline-block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 700;
    letter-spacing: 0.02em;
    color: var(--text-secondary);
    border: 1px solid var(--border-medium);
    padding: 12px 28px;
    transition: border-color 0.15s, color 0.15s;
  }
  .research-page .hero-cta-secondary:hover { border-color: var(--accent-dark); color: var(--accent-dark); }


  /* ═══════════ SECTION HEADINGS ═══════════ */
  .section-heading {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.5rem;
    font-weight: 400;
    color: var(--text-heading);
    line-height: 1.15;
    margin-bottom: 1rem;
    letter-spacing: -0.01em;
  }

  .section-heading + .section-intro {
    margin-top: -0.25rem;
  }

  .section-intro {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    line-height: 1.65;
    max-width: 640px;
    margin-bottom: 2.5rem;
  }

  .programs-section .section-heading {
    margin-bottom: 1rem;
  }


  /* ═══════════ PIPELINE ═══════════ */
  .pipeline-section {
    position: relative;
    padding: 0;
    border-bottom: 1px solid var(--border-light);
  }

  .spiral-scroll-outer {
    position: relative;
    height: 420vh;
  }

  .spiral-scroll-sticky {
    position: sticky;
    top: 0;
    height: 100vh;
    display: flex;
    align-items: center;
    gap: 2rem;
    overflow: visible;
    padding-right: 4rem;
  }

  .spiral-sidebar {
    flex: 0 0 420px;
    padding: 0 0 2rem 0;
    align-self: flex-start;
    margin-top: 6rem;
    margin-left: -2rem;
    z-index: 2;
    order: 2;
  }

  .spiral-sidebar .section-heading {
    font-size: 3rem;
    margin-bottom: 1.5rem;
    margin-left: -2rem;
    line-height: 1.15;
  }

  .pipeline-intro {
    margin-bottom: 0.5rem;
  }

  .pipeline-question {
    font-size: 0.875rem;
    line-height: 1.7;
    color: var(--text-secondary);
  }

  .pipeline-question em {
    font-style: italic;
    color: var(--text-primary);
  }

  .pipeline-answer {
    font-size: 0.875rem;
    line-height: 1.7;
    color: var(--text-body-60);
    margin-top: 0.25rem;
  }

  .pipeline-close {
    font-size: 0.8125rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--text-primary);
    margin-top: 0.35rem;
    font-weight: 700;
  }

  .pipeline-section {
    position: relative;
  }

  #pipeline-sparks {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  .spiral-wrap {
    position: relative;
    flex: 1;
    height: 700px;
    margin-left: -2rem;
  }

  .pipeline-canvas {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 0;
  }

  .spiral-labels {
    position: relative;
    margin-top: 2.5rem;
    overflow: hidden;
    height: 430px;
    -webkit-mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 75%, transparent 100%);
    mask-image: linear-gradient(to bottom, transparent 0%, black 20%, black 75%, transparent 100%);
  }

  .spiral-labels-track {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    will-change: transform;
  }

  .spiral-label {
    text-align: left;
    padding: 1.5rem 1.75rem 1.25rem;
    background: rgba(255, 255, 255, 0.04);
    border-left: 2px solid var(--accent-dark);
    border-radius: 0 4px 4px 0;
  }

  .spiral-label + .spiral-label {
    margin-top: 0.75rem;
  }

  [data-theme="light"] .spiral-label {
    background: rgba(0, 0, 0, 0.03);
  }

  .spiral-num {
    display: block;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.6rem;
    font-weight: 700;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    color: var(--accent-dark);
    opacity: 0.35;
    margin-bottom: 0.4rem;
  }

  .spiral-label h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 600;
    color: var(--text-heading);
    line-height: 1.2;
    margin-bottom: 0.6rem;
  }

  .spiral-label p {
    font-size: 0.85rem;
    color: var(--text-body-60);
    line-height: 1.6;
    margin: 0;
    max-width: 280px;
  }

  /* ── Before → After flow indicator ── */
  .stage-flow {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-top: 1.1rem;
    padding-top: 0.9rem;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
  }

  [data-theme="light"] .stage-flow {
    border-top-color: rgba(0, 0, 0, 0.06);
  }

  .flow-before,
  .flow-after {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 0.04em;
    line-height: 1.3;
    padding: 0.3rem 0.55rem;
    border-radius: 3px;
    white-space: nowrap;
  }

  .flow-before {
    color: var(--text-body-60);
    background: rgba(255, 255, 255, 0.04);
    opacity: 0.6;
  }

  [data-theme="light"] .flow-before {
    background: rgba(0, 0, 0, 0.04);
  }

  .flow-arrow {
    flex-shrink: 0;
    width: 20px;
    height: 1px;
    background: var(--accent-dark);
    opacity: 0.3;
    position: relative;
  }

  .flow-arrow::after {
    content: '';
    position: absolute;
    right: 0;
    top: -2px;
    border: 2px solid transparent;
    border-left: 3px solid var(--accent-dark);
    opacity: 0.4;
  }

  .flow-after {
    color: var(--text-heading);
    background: rgba(255, 255, 255, 0.06);
    opacity: 0.85;
  }

  [data-theme="light"] .flow-after {
    background: rgba(0, 0, 0, 0.05);
  }


  .pipeline-animated .tiers-layout {
    position: relative;
    z-index: 1;
  }

  /* Mobile fallback: no spiral, vertical list */
  .spiral-fallback-list {
    display: none;
  }

  .tiers-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 2rem;
    align-items: start;
    margin-top: -2rem;
    margin-bottom: 2rem;
  }

  .tiers-stack {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .tier-card {
    border: 1px solid var(--border-light);
    border-left: 3px solid var(--border-light);
    padding: 1.5rem 1.5rem 1.25rem;
    transition: border-color 0.2s, background 0.2s;
    background: rgba(255, 255, 255, 0.02);
  }

  .tier-green { border-left-color: var(--accent-green); }
  .tier-warm { border-left-color: var(--chart-warm); }
  .tier-neutral { border-left-color: var(--text-tertiary); }

  [data-theme="light"] .tier-card {
    background: rgba(0, 0, 0, 0.015);
  }

  .tier-card:hover {
    background: rgba(255, 255, 255, 0.04);
  }

  [data-theme="light"] .tier-card:hover {
    background: rgba(0, 0, 0, 0.025);
  }

  .tier-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    margin-bottom: 0.75rem;
  }

  .tier-letter {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: 'Cormorant Garamond', serif;
    font-size: 0.875rem;
    font-weight: 700;
    flex-shrink: 0;
  }

  .tier-letter.green { color: var(--accent-green); border: 2px solid var(--accent-green); }
  .tier-letter.warm { color: var(--chart-warm); border: 2px solid var(--chart-warm); }
  .tier-letter.neutral { color: var(--text-tertiary); border: 2px solid var(--text-tertiary); }

  .tier-meta {
    display: flex;
    flex-direction: column;
    gap: 0.125rem;
  }

  .tier-name {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.15rem;
    font-weight: 600;
    color: var(--text-heading);
    line-height: 1.2;
  }

  .tier-access {
    font-size: 0.6875rem;
    text-transform: uppercase;
    letter-spacing: 0.04em;
    color: var(--text-tertiary);
    font-weight: 500;
  }

  .tier-card p {
    font-size: 0.8125rem;
    color: var(--text-body-60);
    line-height: 1.65;
  }

  .pipeline-feedback {
    display: flex;
    align-items: flex-start;
    gap: 1rem;
    padding: 1.25rem 1.5rem;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid var(--border-light);
    border-radius: 4px;
    max-width: 720px;
  }

  [data-theme="light"] .pipeline-feedback {
    background: rgba(0, 0, 0, 0.02);
  }

  .pipeline-feedback-icon {
    flex-shrink: 0;
    color: var(--accent);
    margin-top: 0.125rem;
  }

  .pipeline-feedback-label {
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    font-weight: 600;
    color: var(--text-heading);
    display: block;
    margin-bottom: 0.375rem;
  }

  .pipeline-feedback-text p {
    font-size: 0.8125rem;
    color: var(--text-body-60);
    line-height: 1.65;
    margin: 0;
  }


  /* ═══════════ PROGRAMS ═══════════ */
  .programs-section {
    padding: 4rem 0;
    border-bottom: 1px solid var(--border-light);
  }

  /* Filter bar */
  .programs-filters {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 0;
    margin-bottom: 2.5rem;
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
  }

  .programs-filters::-webkit-scrollbar {
    display: none;
  }

  .program-filter {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 500;
    color: var(--text-secondary);
    background: var(--bg-card-hover);
    border: 1px solid var(--border-medium);
    border-radius: 4px;
    padding: 8px 14px;
    cursor: pointer;
    white-space: nowrap;
    transition: color 0.15s, background 0.15s, border-color 0.15s;
    flex-shrink: 0;
  }

  .program-filter:hover {
    color: var(--text-heading);
    border-color: var(--accent-border-20);
    background: var(--accent-bg-02);
  }

  .program-filter.active {
    color: var(--accent-dark);
    background: var(--accent-bg-04);
    border-color: var(--accent-border-25);
    font-weight: 600;
  }

  .program-filter-count {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.625rem;
    font-weight: 500;
    color: var(--text-tertiary);
    background: var(--bg-card);
    padding: 1px 6px;
    border-radius: 3px;
    line-height: 1.4;
  }

  .program-filter.active .program-filter-count {
    color: var(--accent-dark);
    background: var(--accent-bg-08);
  }

  .program-card.program-card-hidden {
    display: none;
  }

  .programs-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
  }

  .program-card {
    display: flex;
    flex-direction: column;
    background: var(--bg-card);
    border: 1px solid var(--border-light);
    border-radius: 6px;
    padding: 24px;
    transition: border-color 0.2s, background 0.2s;
  }

  .program-card:hover {
    border-color: var(--accent-border-15);
  }

  .program-num {
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.625rem;
    font-weight: 400;
    letter-spacing: 0.1em;
    color: var(--text-tertiary);
    opacity: 0.7;
    margin-bottom: 8px;
  }

  .program-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    font-weight: 500;
    color: var(--text-heading);
    line-height: 1.25;
    transition: color 0.15s;
  }

  .program-card:hover .program-title {
    color: var(--accent);
  }

  .program-subtitle {
    font-size: 0.875rem;
    font-style: italic;
    color: var(--text-tertiary);
    line-height: 1.25;
    margin: 0 0 12px;
  }

  .program-details-toggle {
    font-family: 'Manrope', sans-serif;
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--text-tertiary);
    cursor: pointer;
    background: none;
    border: none;
    padding: 0;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: color 0.15s;
  }

  .program-details-toggle::before {
    content: '+';
    font-size: 0.875rem;
    font-weight: 600;
    line-height: 1;
  }

  .program-details-toggle:hover {
    color: var(--text-heading);
  }

  :global(.program-card.program-card-active) {
    border-color: var(--accent-border-25);
    background: var(--accent-bg-02);
  }

  :global(.program-card.program-card-active .program-details-toggle)::before {
    content: '−';
  }

  /* Accordion */
  .program-accordion {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease, opacity 0.3s ease, margin 0.3s ease;
    opacity: 0;
    font-size: 0.875rem;
    color: var(--text-body-65);
    line-height: 1.7;
    margin: 0;
  }

  :global(.program-card.program-card-active .program-accordion) {
    max-height: 200px;
    opacity: 1;
    margin: 12px 0 0;
  }

  .program-footer {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: auto;
    padding-top: 12px;
    border-top: 1px solid var(--border-light);
  }

  .program-cta {
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 600;
    color: var(--accent-dark);
    text-decoration: none;
    margin-left: auto;
    white-space: nowrap;
    transition: color 0.15s;
  }

  .program-cta:hover {
    color: var(--accent-darker-hover);
  }

  .program-division,
  .program-status {
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--text-tertiary);
    background: var(--bg-card-hover);
    border: 1px solid rgba(0,0,0,0.04);
    padding: 3px 10px;
    border-radius: 3px;
    white-space: nowrap;
    transition: color 0.2s, background 0.2s, border-color 0.2s;
  }

  .program-card:hover .program-division,
  .program-card:hover .program-status {
    color: #fff;
    background: var(--accent-dark);
    border-color: var(--accent-dark);
  }


  /* ═══════════ ETHICS ═══════════ */
  .ethics-section {
    padding: 4rem 0;
    border-bottom: 1px solid var(--border-light);
  }

  .ethics-section .section-heading {
    margin-bottom: 2rem;
  }

  .ethics-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.25rem;
  }

  .ethics-card {
    border: 1px solid var(--border-light);
    padding: 2rem;
    transition: border-color 0.2s;
  }

  .ethics-card:hover {
    border-color: var(--accent-border-15);
  }

  .ethics-icon {
    color: var(--accent-dark);
    opacity: 0.5;
    margin-bottom: 1.25rem;
  }

  .ethics-card h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.375rem;
    font-weight: 500;
    color: var(--text-heading);
    margin-bottom: 1.25rem;
  }

  .ethics-field {
    margin-bottom: 1rem;
  }

  .ethics-field:last-child {
    margin-bottom: 0;
  }

  .ethics-field-label {
    display: block;
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    color: var(--accent-dark);
    opacity: 0.7;
    margin-bottom: 0.375rem;
  }

  .ethics-field p {
    font-size: 0.875rem;
    color: var(--text-body-65);
    line-height: 1.75;
  }

  .ethics-field a {
    color: inherit;
    font-weight: 600;
  }

  .ethics-field a:hover {
    color: var(--text-heading);
  }


  /* ═══════════ CTA ═══════════ */
  .collab-cta {
    margin: 0 -40px;
    padding: 0;
    background: #141210;
    border-bottom: none;
  }

  .collab-inner {
    max-width: 640px;
    margin: 0 auto;
    padding: 6rem 2rem;
    text-align: center;
  }

  .cta-eyebrow {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: rgba(196, 110, 66, 0.7);
    margin-bottom: 1rem;
  }

  .cta-primary-block h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 3rem;
    font-weight: 400;
    color: #e8dfd0;
    letter-spacing: -0.01em;
    margin: 0 0 1.25rem;
  }

  .cta-primary-block p {
    font-size: 1rem;
    color: rgba(208, 200, 188, 0.55);
    line-height: 1.7;
    max-width: 440px;
    margin: 0 auto 2.5rem;
  }

  .cta-primary-btn {
    display: inline-block;
    padding: 14px 40px;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 600;
    letter-spacing: 0.03em;
    color: #141210;
    background: var(--accent-dark);
    border: none;
    border-radius: 4px;
    text-decoration: none;
    transition: background 0.2s, transform 0.15s;
  }

  .cta-primary-btn:hover {
    background: #d4773a;
    transform: translateY(-1px);
  }

  .cta-secondary-block {
    display: flex;
    justify-content: center;
    gap: 3rem;
    margin-top: 3rem;
    padding-top: 2.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
  }

  .cta-alt {
    text-decoration: none;
    text-align: center;
  }

  .cta-alt-label {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: rgba(208, 200, 188, 0.35);
    margin-bottom: 0.375rem;
  }

  .cta-alt-action {
    display: block;
    font-size: 0.8125rem;
    color: rgba(208, 200, 188, 0.6);
    transition: color 0.2s;
  }

  .cta-alt:hover .cta-alt-action {
    color: #e8dfd0;
  }


  /* ═══════════ DARK MODE ═══════════ */
  :global([data-theme="dark"]) .research-page .hero-cta-primary {
    color: #000;
  }
  :global([data-theme="dark"]) .research-page .hero-cta-primary:hover {
    color: #000;
  }

  :global([data-theme="dark"]) .cta-primary-btn {
    color: #141210;
  }
  :global([data-theme="dark"]) .cta-primary-btn:hover {
    color: #141210;
  }

  :global([data-theme="dark"]) .program-division,
  :global([data-theme="dark"]) .program-status {
    color: var(--text-tertiary);
    background: var(--bg-card-hover);
    border-color: var(--border-light);
  }

  :global([data-theme="dark"]) .program-card:hover .program-division,
  :global([data-theme="dark"]) .program-card:hover .program-status {
    color: #fff;
    background: var(--accent-dark);
    border-color: var(--accent-dark);
  }

  /* ═══════════ RESPONSIVE ═══════════ */
  @media (max-width: 1024px) {
    .research-hero {
      margin: 0 -20px;
    }
    .hero-inner {
      padding: 64px calc(1.5rem + 20px) 48px calc(1rem + 20px);
    }
    .collab-cta { margin: 0 -20px; }
  }

  @media (max-width: 768px) {
    .hero-inner {
      padding: 48px 1.25rem 36px;
    }
    .research-hero {
      margin: 0 -20px;
    }
    .hero-title { font-size: 2.5rem; }
    .hero-lead { padding-left: 0; }
    .hero-cta-row { padding-left: 0; }
    .hero-columns { grid-template-columns: 1fr; }
    .hero-right { order: -1; gap: 1.5rem; }
    .section-heading { font-size: 2rem; }

    .spiral-scroll-outer { height: auto; }
    .spiral-scroll-sticky { position: static; height: auto; flex-direction: column; }
    .spiral-sidebar { flex: none; width: 100%; padding: 1rem 0; }
    .spiral-wrap { height: auto; }
    .pipeline-canvas { display: none; }
    .spiral-labels {
      height: auto;
      overflow: visible;
    }
    .spiral-labels::after { display: none; }
    .spiral-labels-track {
      position: static !important;
      transform: none !important;
    }
    .spiral-label {
      opacity: 1 !important;
    }

    .tiers-layout { grid-template-columns: 1fr; }
    .collab-cta { margin: 0 -20px; }
    .cta-secondary-block { flex-direction: column; gap: 1.5rem; }
    .programs-grid { grid-template-columns: 1fr; }
    .program-card { padding: 20px; }
    .ethics-grid { grid-template-columns: 1fr; }
  }
</style>

<script is:inline data-astro-rerun>
  function initProgramFilters() {
    var filters = document.getElementById('programs-filters')
    var grid = document.querySelector('.programs-grid')
    if (!filters || !grid) return

    var cards = Array.from(grid.querySelectorAll('.program-card'))

    filters.addEventListener('click', function(e) {
      var btn = e.target.closest('.program-filter')
      if (!btn) return

      var division = btn.dataset.division

      filters.querySelectorAll('.program-filter').forEach(function(f) { f.classList.remove('active') })
      btn.classList.add('active')

      var visibleIndex = 0
      cards.forEach(function(card) {
        var match = division === 'All' || card.dataset.division === division
        if (match) {
          card.classList.remove('program-card-hidden')
          visibleIndex++
          var num = card.querySelector('.program-num')
          if (num) num.textContent = String(visibleIndex).padStart(2, '0')
          var divTag = card.querySelector('.program-division')
          if (divTag) divTag.style.display = division === 'All' ? '' : 'none'
        } else {
          card.classList.add('program-card-hidden')
        }
      })
    })
  }

  function initProgramPanel() {
    var toggles = document.querySelectorAll('.program-details-toggle')
    toggles.forEach(function(btn) {
      btn.addEventListener('click', function(e) {
        e.preventDefault()
        var card = btn.closest('.program-card')
        if (!card) return
        if (card.classList.contains('program-card-active')) {
          card.classList.remove('program-card-active')
        } else {
          document.querySelectorAll('.program-card-active').forEach(function(c) {
            c.classList.remove('program-card-active')
          })
          card.classList.add('program-card-active')
        }
      })
    })
  }

  initProgramFilters()
  initProgramPanel()

  var jcuLogo = document.querySelector('.hero-partner-logo')
  if (jcuLogo) {
    jcuLogo.classList.remove('logo-glow')
    setTimeout(function() { jcuLogo.classList.add('logo-glow') }, 600)
  }
</script>

<script is:inline data-astro-rerun>
;function __spiralVizInit() {
  /* ── Cleanup previous instance ── */
  if (window.__spiralCleanup) { window.__spiralCleanup(); window.__spiralCleanup = null }

  /* ── Preflight ── */
  var reducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches
  var section = document.getElementById('pipeline')
  var canvas = document.getElementById('pipeline-canvas')
  var scrollOuter = document.getElementById('spiral-scroll-outer')
  if (!section || !canvas || !scrollOuter) return
  var ctx = canvas.getContext('2d')
  if (!ctx) return
  if (window.innerWidth <= 768) return
  if (reducedMotion) return

  section.classList.add('pipeline-animated')

  /* ── Theme ── */
  function isDark() { return document.documentElement.dataset.theme === 'dark' }

  var COLORS_LIGHT = {
    fwdStart: [220, 130, 40],
    fwdEnd:   [200, 95, 30],
    ret:      [215, 185, 80],
    progress: [230, 180, 80]
  }
  var COLORS_DARK = {
    fwdStart: [235, 145, 50],
    fwdEnd:   [215, 105, 35],
    ret:      [225, 195, 90],
    progress: [240, 200, 100]
  }

  function getColors() { return isDark() ? COLORS_DARK : COLORS_LIGHT }
  function baseAlpha() { return isDark() ? 0.75 : 0.6 }

  function lerpColor(a, b, t) {
    return [a[0]+(b[0]-a[0])*t, a[1]+(b[1]-a[1])*t, a[2]+(b[2]-a[2])*t]
  }

  function rgbStr(c, a) {
    return 'rgba('+Math.round(c[0])+','+Math.round(c[1])+','+Math.round(c[2])+','+a+')'
  }

  /* ── Canvas setup ── */
  var wrap = section.querySelector('.spiral-wrap')
  var labels = section.querySelectorAll('.spiral-label')
  var labelsTrack = document.getElementById('spiral-labels-track')
  var labelOffsets = [] // top offset of each label within the track
  var currentTrackY = 0 // lerp-smoothed carousel position
  var W = 0, H = 0, dpr = 1
  var animId = 0, visible = false, time = 0
  var hoveredNode = -1
  var activeNode = -1
  var resizeTimer = 0
  var progressT = 0
  var prevProgressT = 0

  /* ── Spiral geometry ── */
  var TOTAL_THETA = Math.PI * 5    // ~2.5 turns
  var NODE_COUNT = 8
  var nodeTs = []                   // t-values for each node (0-1)
  var nodePositions = []            // {x, y} for each node
  var spiralA = 20                  // inner radius
  var spiralB = 0                   // computed on resize
  var cx = 0, cy = 0               // center

  var HELIX_CYCLES = 30     // number of uniform oscillations along spiral
  var HELIX_AMP  = 8        // px displacement from spiral backbone
  var HELIX_WAVE = 0        // computed: 2π * HELIX_CYCLES / totalArcLength

  // Arc-length lookup for uniform helix spacing
  var ARC_STEPS = 300
  var arcLens = new Float32Array(ARC_STEPS + 1)

  function computeArcLengths() {
    arcLens[0] = 0
    var prev = spiralPos(0)
    for (var i = 1; i <= ARC_STEPS; i++) {
      var cur = spiralPos(i / ARC_STEPS)
      var dx = cur.x - prev.x, dy = cur.y - prev.y
      arcLens[i] = arcLens[i - 1] + Math.sqrt(dx * dx + dy * dy)
      prev = cur
    }
    HELIX_WAVE = Math.PI * 2 * HELIX_CYCLES / arcLens[ARC_STEPS]
  }

  function arcAtT(t) {
    var idx = t * ARC_STEPS
    var lo = Math.floor(idx)
    if (lo >= ARC_STEPS) return arcLens[ARC_STEPS]
    var hi = lo + 1
    var frac = idx - lo
    return arcLens[lo] + (arcLens[hi] - arcLens[lo]) * frac
  }

  var NODE_END = 0.80  // nodes span 0 to 0.80, before return curve
  for (var i = 0; i < NODE_COUNT; i++) {
    nodeTs.push((i / (NODE_COUNT - 1)) * NODE_END)
  }

  var SPIN_SPEED = 0.04 // radians per second
  var spinOffset = 0 // cached per frame

  // Shell return: after RETURN_START, bezier curves back to spiral origin
  var RETURN_START = 0.82
  var returnMaxR = 0
  // Cached bezier control points for the return curve (updated on resize + each frame for spin)
  var retP0x = 0, retP0y = 0, retP1x = 0, retP1y = 0, retP2x = 0, retP2y = 0

  function updateReturnCurve() {
    // P0: position at RETURN_START (on the spiral)
    var t0 = RETURN_START * TOTAL_THETA + spinOffset
    retP0x = cx + returnMaxR * Math.cos(t0)
    retP0y = cy + returnMaxR * Math.sin(t0)
    // P2: spiral center
    retP2x = cx
    retP2y = cy
    // P1: tangent direction + perpendicular bulge so the curve always arcs
    var tan = spiralTangent(RETURN_START - 0.001)
    var tanLen = Math.sqrt(tan.x * tan.x + tan.y * tan.y) || 1
    var tdx = tan.x / tanLen, tdy = tan.y / tanLen
    var reach = returnMaxR * 0.5
    var bulge = returnMaxR * 0.35
    // Perpendicular to tangent (always creates a curve, never a straight line)
    retP1x = retP0x + tdx * reach + (-tdy) * bulge
    retP1y = retP0y + tdy * reach + tdx * bulge
  }

  function spiralPos(t) {
    if (t <= RETURN_START) {
      var theta = t * TOTAL_THETA + spinOffset
      var r = spiralA + spiralB * (t * TOTAL_THETA)
      return { x: cx + r * Math.cos(theta), y: cy + r * Math.sin(theta) }
    }
    var u = (t - RETURN_START) / (1 - RETURN_START)
    var inv = 1 - u
    return {
      x: inv * inv * retP0x + 2 * inv * u * retP1x + u * u * retP2x,
      y: inv * inv * retP0y + 2 * inv * u * retP1y + u * u * retP2y
    }
  }

  function spiralTangent(t) {
    if (t <= RETURN_START) {
      var theta = t * TOTAL_THETA + spinOffset
      var r = spiralA + spiralB * (t * TOTAL_THETA)
      var dr = spiralB * TOTAL_THETA
      var ct = Math.cos(theta), st = Math.sin(theta)
      return {
        x: dr * ct - r * st * TOTAL_THETA,
        y: dr * st + r * ct * TOTAL_THETA
      }
    }
    var u = (t - RETURN_START) / (1 - RETURN_START)
    var s = 1 / (1 - RETURN_START)
    return {
      x: (2 * (1 - u) * (retP1x - retP0x) + 2 * u * (retP2x - retP1x)) * s,
      y: (2 * (1 - u) * (retP1y - retP0y) + 2 * u * (retP2y - retP1y)) * s
    }
  }

  function computeSpiral() {
    var maxR = Math.min(W, H) * 0.46
    spiralB = (maxR - spiralA) / TOTAL_THETA
    returnMaxR = spiralA + spiralB * (RETURN_START * TOTAL_THETA)
    cx = W / 2
    cy = H / 2
    computeArcLengths()

    nodePositions = []
    for (var i = 0; i < NODE_COUNT; i++) {
      nodePositions.push(spiralPos(nodeTs[i]))
    }
  }

  /* ── Scroll progress ── */
  function getScrollProgress() {
    var rect = scrollOuter.getBoundingClientRect()
    var total = scrollOuter.offsetHeight - window.innerHeight
    if (total <= 0) return 0
    return Math.max(0, Math.min(1, -rect.top / total))
  }

  /* ── Particle pools ── */
  // Forward particles (helix strand A) — spawn from center + boosted from nodes
  var FWD_COUNT = 600
  var FWD_STRIDE = 7 // [t, speed, active, jitter, sinePhase, size, _]
  var fwd = new Float32Array(FWD_COUNT * FWD_STRIDE)

  // Return helix particles (helix strand B) — spiral back from progressT
  var RH_COUNT = 250
  var RH_STRIDE = 6 // [t, speed, active, sinePhase, size, _]
  var rh = new Float32Array(RH_COUNT * RH_STRIDE)

  var nodeGlow = new Float32Array(NODE_COUNT)

  // Sacred geometry petal returns — particles arc back to center in flower-of-life curves
  var GEO_COUNT = 300
  var GEO_STRIDE = 8 // [startX, startY, ctrlX, ctrlY, progress, speed, curveSide, active]
  var geo = new Float32Array(GEO_COUNT * GEO_STRIDE)
  var GEO_AXES = 6 // hexagonal symmetry
  var geoAxAngles = []
  for (var g = 0; g < GEO_AXES; g++) geoAxAngles.push(g * Math.PI * 2 / GEO_AXES)

  /* ── Spawn ── */
  var fwdAccum = 0, fwdNodeAccum = 0, rhAccum = 0

  function spawnFwd() {
    if (progressT < 0.01) return
    // From center
    fwdAccum += 5 + Math.random() * 4
    var toSpawn = Math.floor(fwdAccum)
    if (toSpawn > 0) {
      fwdAccum -= toSpawn
      for (var i = 0; i < FWD_COUNT && toSpawn > 0; i++) {
        var b = i * FWD_STRIDE
        if (fwd[b + 2] === 0) {
          fwd[b]     = Math.random() * 0.005
          fwd[b + 1] = 0.0001 + Math.random() * 0.0012
          fwd[b + 2] = 1
          fwd[b + 3] = (Math.random() - 0.5) * 12
          fwd[b + 4] = Math.random() * Math.PI * 2
          fwd[b + 5] = 1 + Math.random() * 2.5
          toSpawn--
        }
      }
    }
    // From reached nodes (boost — each node emits forward particles)
    var reached = []
    for (var n = 0; n < NODE_COUNT; n++) {
      if (progressT >= nodeTs[n] + 0.01 && nodeTs[n] < progressT - 0.02) reached.push(n)
    }
    if (reached.length === 0) return
    fwdNodeAccum += (1 + Math.random() * 1) * reached.length
    var nodeSpawn = Math.floor(fwdNodeAccum)
    if (nodeSpawn <= 0) return
    fwdNodeAccum -= nodeSpawn
    for (var i = 0; i < FWD_COUNT && nodeSpawn > 0; i++) {
      var b = i * FWD_STRIDE
      if (fwd[b + 2] === 0) {
        var ni = reached[Math.floor(Math.random() * reached.length)]
        fwd[b]     = nodeTs[ni] + Math.random() * 0.01
        fwd[b + 1] = 0.0001 + Math.random() * 0.001
        fwd[b + 2] = 1
        fwd[b + 3] = (Math.random() - 0.5) * 10
        fwd[b + 4] = Math.random() * Math.PI * 2
        fwd[b + 5] = 1 + Math.random() * 2.5
        nodeSpawn--
      }
    }
  }

  function spawnRetHelix() {
    if (progressT < 0.08) return
    rhAccum += 3 + Math.random() * 3
    var toSpawn = Math.floor(rhAccum)
    if (toSpawn <= 0) return
    rhAccum -= toSpawn
    for (var i = 0; i < RH_COUNT && toSpawn > 0; i++) {
      var b = i * RH_STRIDE
      if (rh[b + 2] === 0) {
        rh[b]     = progressT * 0.75 + Math.random() * progressT * 0.2
        rh[b + 1] = 0.0002 + Math.random() * 0.0006
        rh[b + 2] = 1
        rh[b + 3] = Math.random() * Math.PI * 2
        rh[b + 4] = 0.8 + Math.random() * 1.8
        toSpawn--
      }
    }
  }

  /* ── Draw double-helix guide paths (up to progressT) ── */
  function drawSpiralPath() {
    if (progressT < 0.005) return
    var c = getColors()
    var steps = Math.max(2, Math.floor(300 * progressT))
    // Return curve: use t-based wave (arc lengths are stale due to spin rotation)
    var retArcAtStart = arcAtT(RETURN_START)
    var RET_CYCLES = 4 // oscillations along the return curve
    var RET_WAVE = Math.PI * 2 * RET_CYCLES / (1 - RETURN_START)

    // Strand A (forward helix)
    ctx.beginPath()
    for (var i = 0; i <= steps; i++) {
      var t = (i / 300)
      if (t > progressT) break
      var p = spiralPos(t)
      var tan = spiralTangent(t)
      var len = Math.sqrt(tan.x * tan.x + tan.y * tan.y) || 1
      var nx = -tan.y / len, ny = tan.x / len
      var wave, d
      if (t > RETURN_START) {
        wave = HELIX_WAVE * retArcAtStart + RET_WAVE * (t - RETURN_START)
        d = HELIX_AMP * Math.sin(wave)
      } else {
        d = HELIX_AMP * Math.sin(HELIX_WAVE * arcAtT(t))
      }
      var hx = p.x + nx * d, hy = p.y + ny * d
      if (i === 0) ctx.moveTo(hx, hy)
      else ctx.lineTo(hx, hy)
    }
    var pulseAlpha = 0.04 + 0.04 * Math.sin(time * 0.8)
    ctx.strokeStyle = 'rgba(255,255,255,' + pulseAlpha + ')'
    ctx.lineWidth = 0.5
    ctx.stroke()

    // Strand B (return helix — π out of phase)
    ctx.beginPath()
    for (var i = 0; i <= steps; i++) {
      var t = (i / 300)
      if (t > progressT) break
      var p = spiralPos(t)
      var tan = spiralTangent(t)
      var len = Math.sqrt(tan.x * tan.x + tan.y * tan.y) || 1
      var nx = -tan.y / len, ny = tan.x / len
      var wave, d
      if (t > RETURN_START) {
        wave = HELIX_WAVE * retArcAtStart + RET_WAVE * (t - RETURN_START)
        d = HELIX_AMP * Math.sin(wave + Math.PI)
      } else {
        d = HELIX_AMP * Math.sin(HELIX_WAVE * arcAtT(t) + Math.PI)
      }
      var hx = p.x + nx * d, hy = p.y + ny * d
      if (i === 0) ctx.moveTo(hx, hy)
      else ctx.lineTo(hx, hy)
    }
    ctx.strokeStyle = 'rgba(255,255,255,' + pulseAlpha + ')'
    ctx.lineWidth = 0.5
    ctx.stroke()
  }

  /* ── Update & draw forward particles ── */
  function drawForward() {
    var c = getColors()
    var ba = baseAlpha()
    var fadeZone = progressT - 0.05
    var cs0 = c.fwdStart[0], cs1 = c.fwdStart[1], cs2 = c.fwdStart[2]
    var cd0 = c.fwdEnd[0] - cs0, cd1 = c.fwdEnd[1] - cs1, cd2 = c.fwdEnd[2] - cs2
    for (var i = 0; i < FWD_COUNT; i++) {
      var b = i * FWD_STRIDE
      if (fwd[b + 2] === 0) continue

      var slowZone = progressT - 0.15
      var speedMul = (fwd[b] > slowZone && progressT > 0.2) ? Math.max(0.15, (progressT - fwd[b]) / 0.15) : 1
      fwd[b] += fwd[b + 1] * speedMul
      if (fwd[b] >= progressT) { fwd[b + 2] = 0; continue }

      var t = fwd[b]
      var posX, posY, tx, ty
      if (t > RETURN_START) {
        var p = spiralPos(t), tn = spiralTangent(t)
        posX = p.x; posY = p.y; tx = tn.x; ty = tn.y
      } else {
        var theta = t * TOTAL_THETA + spinOffset
        var r = spiralA + spiralB * (t * TOTAL_THETA)
        var ct = Math.cos(theta), st = Math.sin(theta)
        posX = cx + r * ct; posY = cy + r * st
        var dr = spiralB * TOTAL_THETA
        tx = dr * ct - r * st * TOTAL_THETA
        ty = dr * st + r * ct * TOTAL_THETA
      }
      var len = Math.sqrt(tx * tx + ty * ty) || 1
      var fWave
      if (t > RETURN_START) {
        fWave = HELIX_WAVE * arcAtT(RETURN_START) + (Math.PI * 2 * 4 / (1 - RETURN_START)) * (t - RETURN_START)
      } else {
        fWave = HELIX_WAVE * arcAtT(t)
      }
      var d = HELIX_AMP * Math.sin(fWave) + fwd[b + 3] * Math.sin(time * 2.5 + fwd[b + 4]) * 0.6
      var px = posX + (-ty / len) * d
      var py = posY + (tx / len) * d

      var a = ba
      if (t < 0.05) a = (t / 0.05) * ba
      if (fadeZone > 0 && t > fadeZone) a *= (progressT - t) / 0.05

      ctx.fillStyle = 'rgba(' + ((cs0 + cd0 * t) | 0) + ',' + ((cs1 + cd1 * t) | 0) + ',' + ((cs2 + cd2 * t) | 0) + ',' + a + ')'
      ctx.beginPath()
      ctx.arc(px, py, fwd[b + 5] * 0.4, 0, Math.PI * 2)
      ctx.fill()
    }
  }

  /* ── Update & draw helix return particles (spiral back along strand B) ── */
  function drawReturnHelix() {
    var c = getColors()
    var ba = baseAlpha() * 0.6
    var cr0 = c.ret[0] | 0, cr1 = c.ret[1] | 0, cr2 = c.ret[2] | 0
    var retPrefix = 'rgba(' + cr0 + ',' + cr1 + ',' + cr2 + ','
    for (var i = 0; i < RH_COUNT; i++) {
      var b = i * RH_STRIDE
      if (rh[b + 2] === 0) continue

      rh[b] -= rh[b + 1]
      if (rh[b] <= 0) { rh[b + 2] = 0; continue }

      var t = rh[b]
      var posX, posY, tx, ty
      if (t > RETURN_START) {
        var p = spiralPos(t), tn = spiralTangent(t)
        posX = p.x; posY = p.y; tx = tn.x; ty = tn.y
      } else {
        var theta = t * TOTAL_THETA + spinOffset
        var r = spiralA + spiralB * (t * TOTAL_THETA)
        var ct = Math.cos(theta), st = Math.sin(theta)
        posX = cx + r * ct; posY = cy + r * st
        var dr = spiralB * TOTAL_THETA
        tx = dr * ct - r * st * TOTAL_THETA
        ty = dr * st + r * ct * TOTAL_THETA
      }
      var len = Math.sqrt(tx * tx + ty * ty) || 1
      var rWave
      if (t > RETURN_START) {
        rWave = HELIX_WAVE * arcAtT(RETURN_START) + (Math.PI * 2 * 4 / (1 - RETURN_START)) * (t - RETURN_START)
      } else {
        rWave = HELIX_WAVE * arcAtT(t)
      }
      var d = HELIX_AMP * Math.sin(rWave + Math.PI) + Math.sin(time * 1.5 + rh[b + 3]) * 0.6
      var px = posX + (-ty / len) * d
      var py = posY + (tx / len) * d

      var a = ba
      if (t < 0.05) a *= t / 0.05

      ctx.fillStyle = retPrefix + a + ')'
      ctx.beginPath()
      ctx.arc(px, py, rh[b + 4] * 0.4, 0, Math.PI * 2)
      ctx.fill()
    }
  }

  /* ── Sacred geometry petal returns ── */
  var geoAccum = 0

  function spawnGeo() {
    if (progressT < 0.1) return
    geoAccum += 4 + Math.random() * 3
    var toSpawn = Math.floor(geoAccum)
    if (toSpawn <= 0) return
    geoAccum -= toSpawn
    for (var i = 0; i < GEO_COUNT && toSpawn > 0; i++) {
      var b = i * GEO_STRIDE
      if (geo[b + 7] === 0) {
        // Bias toward outer edge of reached spiral
        var r = Math.random()
        var t = r * r * progressT * 0.85
        var pos = spiralPos(t)
        var dx = pos.x - cx, dy = pos.y - cy
        var dist = Math.sqrt(dx * dx + dy * dy)
        var angle = Math.atan2(dy, dx)
        // Snap to nearest hexagonal axis
        var bestAxis = 0, bestDiff = Math.PI * 2
        for (var a = 0; a < GEO_AXES; a++) {
          var diff = Math.abs(angle - geoAxAngles[a])
          if (diff > Math.PI) diff = Math.PI * 2 - diff
          if (diff < bestDiff) { bestDiff = diff; bestAxis = a }
        }
        var axAngle = geoAxAngles[bestAxis]
        var sx = cx + Math.cos(axAngle) * dist
        var sy = cy + Math.sin(axAngle) * dist
        // Control point: perpendicular to radius at ~50-70% out, alternating sides
        var side = (Math.random() > 0.5) ? 1 : -1
        var perpAngle = axAngle + side * Math.PI * 0.5
        var bulge = dist * (0.4 + Math.random() * 0.3)
        var midR = dist * (0.4 + Math.random() * 0.2)
        var cpx = cx + Math.cos(axAngle) * midR + Math.cos(perpAngle) * bulge
        var cpy = cy + Math.sin(axAngle) * midR + Math.sin(perpAngle) * bulge
        geo[b]     = sx     // startX
        geo[b + 1] = sy     // startY
        geo[b + 2] = cpx    // ctrlX
        geo[b + 3] = cpy    // ctrlY
        geo[b + 4] = 0      // progress (0→1)
        geo[b + 5] = 0.003 + Math.random() * 0.005  // speed
        geo[b + 6] = side   // curve side (for visual variety)
        geo[b + 7] = 1      // active
        toSpawn--
      }
    }
  }

  function drawGeo() {
    var c = getColors()
    var ba = baseAlpha() * 0.4
    var cr0 = c.ret[0] | 0, cr1 = c.ret[1] | 0, cr2 = c.ret[2] | 0
    var geoPrefix = 'rgba(' + cr0 + ',' + cr1 + ',' + cr2 + ','
    // Cache origin once per frame
    var origin = spiralPos(0)
    var ox = origin.x, oy = origin.y
    for (var i = 0; i < GEO_COUNT; i++) {
      var b = i * GEO_STRIDE
      if (geo[b + 7] === 0) continue

      geo[b + 4] += geo[b + 5]
      if (geo[b + 4] >= 1) { geo[b + 7] = 0; continue }

      var p = geo[b + 4]
      var inv = 1 - p
      var px = inv * inv * geo[b] + 2 * inv * p * geo[b + 2] + p * p * ox
      var py = inv * inv * geo[b + 1] + 2 * inv * p * geo[b + 3] + p * p * oy

      var a = ba
      if (p < 0.1) a *= p / 0.1
      if (p > 0.8) a *= (1 - p) / 0.2

      ctx.fillStyle = geoPrefix + a + ')'
      ctx.beginPath()
      ctx.arc(px, py, 0.6, 0, Math.PI * 2)
      ctx.fill()
    }
  }

  /* ── Update label carousel — smooth continuous slide ── */
  function updateLabels() {
    // Find which node we're at and how far between this and next
    activeNode = 0
    var fraction = 0
    for (var i = NODE_COUNT - 1; i >= 0; i--) {
      if (progressT >= nodeTs[i] - 0.01) {
        activeNode = i
        // Compute fraction toward next node (for smooth interpolation)
        if (i < NODE_COUNT - 1) {
          var span = nodeTs[i + 1] - nodeTs[i]
          fraction = Math.max(0, Math.min(1, (progressT - nodeTs[i]) / span))
        }
        break
      }
    }

    // Map activeNode to label index (labels are data-node 1-7, activeNode 0-7)
    // Label index for activeNode: activeNode - 1
    var activeLabelIdx = activeNode - 1
    var nextLabelIdx = activeLabelIdx + 1

    // Map progressT directly to track position — continuous, no stepping
    // Extends past last card so it scrolls up and out through the mask
    var topPad = 100
    if (labelsTrack && labelOffsets.length > 1) {
      var lastOff = labelOffsets[labelOffsets.length - 1]
      var lastCard = labels[labels.length - 1]
      var exitExtra = lastCard ? lastCard.offsetHeight + topPad + 40 : 300
      var t = Math.max(0, (progressT - nodeTs[1]) / (1 - nodeTs[1]))
      var targetY = t * (lastOff + exitExtra)
      labelsTrack.style.transform = 'translateY(' + (topPad - targetY) + 'px)'
    }

  }

  /* ── Resize ── */
  function resize() {
    var rect = wrap.getBoundingClientRect()
    dpr = Math.min(window.devicePixelRatio || 1, 2)
    W = rect.width
    H = rect.height
    canvas.width = W * dpr
    canvas.height = H * dpr
    canvas.style.width = W + 'px'
    canvas.style.height = H + 'px'
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0)
    computeSpiral()
    // Cache label top offsets within track
    labelOffsets = []
    for (var j = 0; j < labels.length; j++) {
      labelOffsets.push(labels[j].offsetTop)
    }
  }

  function debouncedResize() {
    clearTimeout(resizeTimer)
    resizeTimer = setTimeout(resize, 200)
  }
  window.addEventListener('resize', debouncedResize)

  /* ── Hover detection (node glow only) ── */
  section.addEventListener('mousemove', function(e) {
    var rect = wrap.getBoundingClientRect()
    var mx = e.clientX - rect.left
    var my = e.clientY - rect.top
    hoveredNode = -1
    for (var i = 0; i < NODE_COUNT; i++) {
      var np = nodePositions[i]
      if (!np) continue
      var dx = mx - np.x, dy = my - np.y
      if (Math.sqrt(dx * dx + dy * dy) < 40) { hoveredNode = i; break }
    }
  })
  section.addEventListener('mouseleave', function() {
    hoveredNode = -1
  })

  /* ── Scroll drives carousel naturally via progressT + lerp in updateLabels ── */

  /* ── Main loop ── */
  function tick() {
    if (!visible) { animId = 0; return }
    animId = requestAnimationFrame(tick)
    time += 0.016

    spinOffset = time * SPIN_SPEED
    updateReturnCurve()
    prevProgressT = progressT
    progressT = getScrollProgress()

    // Kill particles beyond progress when scrolling back
    if (progressT < prevProgressT - 0.002) {
      for (var i = 0; i < FWD_COUNT; i++) {
        var b = i * FWD_STRIDE
        if (fwd[b + 2] === 1 && fwd[b] > progressT) fwd[b + 2] = 0
      }
      for (var i = 0; i < RH_COUNT; i++) {
        var b = i * RH_STRIDE
        if (rh[b + 2] === 1 && rh[b] > progressT) rh[b + 2] = 0
      }
      for (var i = 0; i < GEO_COUNT; i++) {
        var b = i * GEO_STRIDE
        if (geo[b + 7] === 1) geo[b + 7] = 0
      }
    }

    ctx.clearRect(0, 0, W, H)

    spawnFwd()
    spawnRetHelix()
    spawnGeo()
    drawSpiralPath()
    drawGeo()
    drawForward()
    drawReturnHelix()
    updateLabels()
  }

  /* ── Visibility gating ── */
  var visObs = new IntersectionObserver(function(entries) {
    for (var i = 0; i < entries.length; i++) {
      if (entries[i].isIntersecting) {
        visible = true
        if (!animId) { resize(); animId = requestAnimationFrame(tick) }
      } else {
        visible = false
      }
    }
  }, { threshold: 0.01 })
  visObs.observe(scrollOuter)

  /* ── Theme reactivity ── */
  var themeObs = new MutationObserver(function() {
    if (visible) resize()
  })
  themeObs.observe(document.documentElement, { attributes: true, attributeFilter: ['data-theme'] })

  /* ── Cleanup for View Transitions ── */
  window.__spiralCleanup = function() {
    if (animId) cancelAnimationFrame(animId)
    animId = 0; visible = false
    visObs.disconnect()
    themeObs.disconnect()
    window.removeEventListener('resize', debouncedResize)
    section.classList.remove('pipeline-animated')
  }
}
__spiralVizInit()
</script>

<script is:inline data-astro-rerun>
;function __sparksInit() {
  if (window.__sparksCleanup) { window.__sparksCleanup(); window.__sparksCleanup = null }

  var section = document.getElementById('pipeline')
  var c = document.getElementById('pipeline-sparks')
  if (!section || !c) return
  var ctx = c.getContext('2d')

  var SPARK_COUNT = 60
  var sparks = new Float32Array(SPARK_COUNT * 6)
  var W = 0, H = 0, dpr = 1, animId = 0, visible = false

  function resize() {
    dpr = Math.min(window.devicePixelRatio || 1, 2)
    W = section.offsetWidth
    H = section.offsetHeight
    c.width = W * dpr
    c.height = H * dpr
    c.style.width = W + 'px'
    c.style.height = H + 'px'
    ctx.setTransform(dpr, 0, 0, dpr, 0, 0)
  }

  function spawn(i) {
    var b = i * 6
    sparks[b]     = Math.random() * W
    sparks[b + 1] = Math.random() * H
    sparks[b + 2] = (Math.random() - 0.5) * 0.4
    sparks[b + 3] = -0.15 - Math.random() * 0.5
    sparks[b + 4] = 0
    sparks[b + 5] = 60 + Math.random() * 80
  }

  for (var i = 0; i < SPARK_COUNT; i++) {
    spawn(i)
    sparks[i * 6 + 4] = Math.random() * sparks[i * 6 + 5]
  }

  function tick() {
    if (!visible) { animId = 0; return }
    animId = requestAnimationFrame(tick)
    ctx.clearRect(0, 0, W, H)

    var isDark = document.documentElement.dataset.theme !== 'light'
    var r = isDark ? 255 : 180
    var g = isDark ? 210 : 140
    var bv = isDark ? 140 : 80

    for (var i = 0; i < SPARK_COUNT; i++) {
      var b = i * 6
      sparks[b + 4] += 1
      if (sparks[b + 4] >= sparks[b + 5]) { spawn(i); continue }

      sparks[b] += sparks[b + 2]
      sparks[b + 1] += sparks[b + 3]

      var lifeT = sparks[b + 4] / sparks[b + 5]
      var alpha = lifeT < 0.2 ? lifeT / 0.2 : 1 - (lifeT - 0.2) / 0.8
      alpha *= 0.7

      if (Math.random() < 0.1) alpha *= 0.3

      var size = 1.5 + (1 - lifeT) * 1.5

      ctx.fillStyle = 'rgba(' + r + ',' + g + ',' + bv + ',' + alpha + ')'
      ctx.fillRect(sparks[b], sparks[b + 1], size, size)
    }
  }

  resize()
  window.addEventListener('resize', resize)

  var visObs = new IntersectionObserver(function(entries) {
    for (var i = 0; i < entries.length; i++) {
      if (entries[i].isIntersecting) {
        visible = true
        if (!animId) animId = requestAnimationFrame(tick)
      } else { visible = false }
    }
  }, { threshold: 0.01 })
  visObs.observe(section)

  window.__sparksCleanup = function() {
    if (animId) cancelAnimationFrame(animId)
    animId = 0; visible = false
    visObs.disconnect()
    window.removeEventListener('resize', resize)
  }
}
__sparksInit()
</script>


