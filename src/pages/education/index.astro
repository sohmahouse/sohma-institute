---
import PortalLayout from '../../layouts/PortalLayout.astro'
---

<PortalLayout
  title="Education Programs — Sohma Institute"
  description="Clinical mentorship, case-based learning, and supervised practice across four credential tiers. The Institute does not pay clinicians to lecture. It pays them to mentor."
>
  <article class="edu-page">

    <!-- HERO -->
    <header class="edu-hero">
      <div class="hero-inner">
        <div class="section-label">Education Programs</div>
        <h1 class="hero-title">We don't pay clinicians to lecture.</h1>
        <p class="hero-subtitle"><span class="hero-accent">We pay them to mentor.</span></p>
        <p class="hero-lead">The education architecture rejects the lecture-hall reproduction model. Every credential is built on clinical mentorship, case-based learning, and supervised practice within real patient populations. Didactic content is delivered asynchronously; synchronous time is reserved for clinical reasoning, supervised application, and peer case conferencing.</p>
      </div>
    </header>


    <!-- PEDAGOGICAL COMMITMENTS -->
    <section class="pillars-section">
      <span class="pillars-eyebrow">How We Teach</span>
      <h2 class="section-heading">Pedagogical Commitments</h2>
      <div class="pillars-grid">
        <a href="/education/pedagogy" class="pillar-card">
          <h3>Case-Based Architecture</h3>
          <p>Every unit of competency is assessed through real clinical cases, not simulated scenarios. Students work within the Sohma House patient population from Tier 1 onward, with supervision intensity calibrated to credential level.</p>
        </a>
        <a href="/education/pedagogy" class="pillar-card">
          <h3>Inverse Classroom</h3>
          <p>Didactic content is asynchronous. All synchronous contact hours are dedicated to clinical reasoning, case presentation, supervised practice, and peer conferencing. We don't pay clinicians to lecture. We pay them to mentor.</p>
        </a>
        <a href="/education/pedagogy" class="pillar-card">
          <h3>Portfolio Assessment</h3>
          <p>No written examinations. Competency is demonstrated through clinical portfolios containing case documentation, reflective practice records, supervisor evaluations, and peer review. The portfolio becomes the practitioner's ongoing professional development record.</p>
        </a>
      </div>
    </section>


    <!-- CREDENTIAL LADDER -->
    <section class="ladder-section">
      <h2 class="section-heading">Credential Ladder</h2>
      <p class="section-intro">Four credential tiers, each building on the last. Your tier determines your clinical autonomy, supervisory responsibilities, and depth of access to the Institute's protocol library.</p>

      <div class="ladder">
        <div class="ladder-track">
          <div class="track-bg"></div>
          <div class="track-fill"></div>
        </div>

        <div class="ladder-tier tier-1">
          <div class="ladder-left">
            <span class="ladder-letter">1</span>
            <h3>Foundation Certificate</h3>
          </div>
          <div class="ladder-right">
            <span class="ladder-badge">12 weeks &middot; Online + Clinical Intensive</span>
            <p class="ladder-summary">Entry point for registered health practitioners seeking to add traditional medicine competencies.</p>
            <p class="ladder-detail">Foundational literacy in one division. Systems biology primer, clinical reasoning methodology, regulatory and ethical frameworks. Prerequisite: current AHPRA registration or equivalent.</p>

          </div>
        </div>

        <div class="ladder-tier tier-2">
          <div class="ladder-left">
            <span class="ladder-letter">2</span>
            <h3>Advanced Diploma</h3>
          </div>
          <div class="ladder-right">
            <span class="ladder-badge">12 months &middot; Hybrid Clinical Mentorship</span>
            <p class="ladder-summary">Deep specialisation with mandatory cross-divisional elective and 200 hours supervised clinical practice.</p>
            <p class="ladder-detail">Deep specialisation in one division with mandatory cross-divisional elective. 200 hours supervised clinical practice within Sohma House or partner sites. Clinical portfolio assessment rather than examination. Produces competent clinical practitioners in their chosen division.</p>

          </div>
        </div>

        <div class="ladder-tier tier-3">
          <div class="ladder-left">
            <span class="ladder-letter">3</span>
            <h3>Graduate Diploma</h3>
          </div>
          <div class="ladder-right">
            <span class="ladder-badge">18 months &middot; Research + Clinical Integration</span>
            <p class="ladder-summary">Cross-divisional clinical reasoning at complexity with original research contribution.</p>
            <p class="ladder-detail">Requires integration of minimum two divisional frameworks. Original research contribution (case series, systematic review, or protocol validation). Articulation pathway to university Master's programs through partner institutions.</p>

          </div>
        </div>

        <div class="ladder-tier tier-4">
          <div class="ladder-left">
            <span class="ladder-letter">4</span>
            <h3>Fellowship</h3>
          </div>
          <div class="ladder-right">
            <span class="ladder-badge">2 years &middot; Clinical Leadership + Research</span>
            <p class="ladder-summary">The Institute's highest credential. Produces clinical leaders and future faculty.</p>
            <p class="ladder-detail">Fellows produce original research, supervise clinical trainees, and contribute to protocol development. Fellowship requires demonstrated capacity to operate across three or more divisions simultaneously. Produces clinical leaders and future Institute faculty.</p>

          </div>
        </div>
      </div>
    </section>


    <!-- DIVISIONS -->
    <section class="divisions-section">
      <div class="divisions-inner">
        <span class="divisions-eyebrow">Academic Divisions</span>
        <h2 class="divisions-heading">Every tier is studied within a Division</h2>
        <p class="divisions-intro">When you enrol, you choose both a credential tier and a division. The tier determines your level of training and autonomy. The division determines your clinical specialisation.</p>

        <div class="divisions-grid">
          <a href="/#divisions" class="division-card" data-accent="terracotta">
            <span class="division-dot"></span>
            <span class="division-num">I</span>
            <h3>Complex Herbal Medicines</h3>
            <p>Multi-constituent botanical therapeutics, phytochemical synergy, and clinical herbal prescribing.</p>
          </a>

          <a href="/#divisions" class="division-card" data-accent="warm">
            <span class="division-dot"></span>
            <span class="division-num">II</span>
            <h3>Emergent &amp; Entheogenic Modalities</h3>
            <p>Cannabis medicine, psilocybin-assisted therapy, psychedelic integration, and novel therapeutic frameworks.</p>
          </a>

          <a href="/#divisions" class="division-card" data-accent="blue">
            <span class="division-dot"></span>
            <span class="division-num">III</span>
            <h3>Systems &amp; Functional Medicine</h3>
            <p>Systems biology approaches to chronic complex illness, functional diagnostics, metabolomic and genomic interpretation.</p>
          </a>

          <a href="/#divisions" class="division-card" data-accent="teal">
            <span class="division-dot"></span>
            <span class="division-num">IV</span>
            <h3>Environmental &amp; Nutritional Medicine</h3>
            <p>Toxicant exposure assessment, environmental determinants, clinical nutrition, microbiome therapeutics.</p>
          </a>

          <a href="/#divisions" class="division-card" data-accent="purple">
            <span class="division-dot"></span>
            <span class="division-num">V</span>
            <h3>Lifestyle &amp; Relational Medicine</h3>
            <p>Somatic therapy, contemplative practice, movement medicine, sleep architecture, and relational health.</p>
          </a>
        </div>
      </div>
    </section>


    <!-- CTA -->
    <section class="cta-section">
      <div class="cta-inner">
        <div class="cta-primary-block">
          <span class="cta-eyebrow">Get Started</span>
          <h2>Ready to begin?</h2>
          <p>Tell us where you're starting and where you want to go. Expressions of interest are open for all credential tiers.</p>
          <a href="/contact" class="cta-primary-btn">Express interest &rarr;</a>
        </div>
        <div class="cta-secondary-block">
          <a href="#" class="cta-alt">
            <span class="cta-alt-label">Want details first?</span>
            <span class="cta-alt-action">Download prospectus &rarr;</span>
          </a>
          <a href="/network" class="cta-alt">
            <span class="cta-alt-label">Already credentialed?</span>
            <span class="cta-alt-action">Enter The Field &rarr;</span>
          </a>
        </div>
      </div>
    </section>

  </article>
</PortalLayout>

<style>
  .edu-page {
    font-family: 'Manrope', sans-serif;
    color: var(--text-heading);
    padding: 0;
    overflow: hidden;
  }
  .edu-page p { line-height: 1.8; margin: 0 0 1rem; }
  .edu-page p:last-child { margin-bottom: 0; }
  .edu-page h2, .edu-page h3 { margin: 0; }

  .section-label {
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.18em;
    color: var(--accent-dark);
    margin-bottom: 1.25rem;
  }
  .section-label::after {
    content: '';
    flex: 1;
    height: 1px;
    background: var(--accent-line);
  }

  .section-heading {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.5rem;
    font-weight: 400;
    color: var(--text-heading);
    line-height: 1.2;
    margin-bottom: 0.75rem;
    letter-spacing: -0.01em;
  }

  .section-intro {
    font-size: 0.9375rem;
    color: var(--text-body-65);
    line-height: 1.85;
    max-width: 680px;
    margin-bottom: 2rem;
  }


  /* ═══════════ HERO ═══════════ */
  .edu-hero {
    position: relative;
    max-width: none;
    margin: 0 -40px;
    padding: 0;
    background: var(--bg-hero);
    overflow: visible;
  }

  .hero-inner {
    position: relative;
    z-index: 1;
    padding: 96px calc(2rem + 40px) 64px calc(1rem + 40px);
    border-bottom: 1px solid var(--border-light);
  }

  .hero-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2.25rem, 4vw, 3.5rem);
    font-weight: 500;
    line-height: 1.1;
    letter-spacing: -0.01em;
    color: var(--text-heading);
    max-width: 800px;
    margin: 0;
  }

  .hero-subtitle {
    font-family: 'Cormorant Garamond', serif;
    font-size: clamp(2rem, 4vw, 3.25rem);
    font-weight: 500;
    line-height: 1.1;
    letter-spacing: -0.01em;
    max-width: 800px;
    margin: 0 0 24px;
  }

  .hero-accent {
    font-style: italic;
    color: var(--accent-dark);
  }

  .hero-lead {
    font-size: 1.0625rem;
    color: var(--text-secondary);
    line-height: 1.65;
    max-width: 640px;
    padding-left: 1.5rem;
  }


  /* ═══════════ PEDAGOGY PILLARS ═══════════ */
  .pillars-section {
    padding: 5rem 0 4rem;
    border-bottom: 1px solid var(--border-light);
  }

  .pillars-eyebrow {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: var(--accent-dark);
    opacity: 0.7;
    margin-bottom: 0.75rem;
  }

  .pillars-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 0 2.5rem;
    margin-top: 2.5rem;
  }

  .pillar-card {
    display: block;
    padding: 1.75rem 0 0;
    border-top: 1px solid var(--border-light);
    text-decoration: none;
    transition: border-color 0.2s;
  }

  .pillar-card:hover {
    border-color: var(--accent-dark);
  }

  .pillar-card h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.35rem;
    font-weight: 500;
    color: var(--text-heading);
    margin-bottom: 0.875rem;
  }

  .pillar-card p {
    font-size: 0.8125rem;
    color: var(--text-body-60);
    line-height: 1.75;
    margin-bottom: 0;
  }


  /* ═══════════ CREDENTIAL LADDER ═══════════ */
  .ladder-section {
    padding: 7rem 0 4rem;
    border-bottom: 1px solid var(--border-light);
    text-align: center;
  }

  .ladder-section .section-intro {
    margin-left: auto;
    margin-right: auto;
  }

  .ladder {
    position: relative;
    max-width: 720px;
    margin: 0 auto;
  }

  /* ── Continuous progress track ── */
  .ladder-track {
    position: absolute;
    left: calc(180px + 1rem);
    top: 2rem;
    bottom: 2rem;
    width: 24px;
    display: flex;
    flex-direction: column;
    align-items: center;
    z-index: 1;
    pointer-events: none;
  }

  .ladder-track .track-bg {
    position: absolute;
    top: 0;
    bottom: 0;
    width: 2px;
    background: var(--border-light);
  }

  .ladder-track .track-fill {
    position: absolute;
    top: 0;
    width: 2px;
    height: 0;
    background: var(--accent-dark);
  }

  /* ── Shared tier — two-column layout ── */
  .ladder-tier {
    display: grid;
    grid-template-columns: 180px 1fr;
    gap: 0 calc(24px + 4rem);
    padding: 7rem 0;
  }

  /* Left column — identity */
  .ladder-left {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .ladder-letter {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 52px;
    height: 52px;
    border-radius: 50%;
    border: 2px solid var(--border-light);
    font-family: 'JetBrains Mono', monospace;
    font-size: 1.25rem;
    font-weight: 700;
    letter-spacing: 0.05em;
    line-height: 1;
    margin-bottom: 0.75rem;
    overflow: visible;
    color: var(--text-tertiary);
    transition: border-color 0.3s, color 0.3s;
  }

  .ladder-left h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.75rem;
    font-weight: 500;
    color: var(--text-tertiary);
    line-height: 1.1;
    margin: 0 0 0.625rem;
    transition: color 0.25s;
  }

  .ladder-badge {
    display: inline-block;
    margin-bottom: 1rem;
    font-family: 'Manrope', sans-serif;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    padding: 4px 10px;
    border-radius: 2px;
    color: var(--text-tertiary);
    background: transparent;
    border: 1px solid var(--border-light);
    transition: color 0.25s, border-color 0.25s, background 0.25s;
  }

  /* Right column — content */
  .ladder-right {
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 0.5s ease, transform 0.5s ease;
    max-width: 480px;
    text-align: left;
  }

  .ladder-right.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .ladder-summary {
    font-size: 1.25rem;
    color: var(--text-tertiary);
    line-height: 1.7;
    margin: 0 0 0.875rem;
    transition: color 0.3s;
  }

  .ladder-detail {
    font-size: 0.9375rem;
    color: var(--text-tertiary);
    line-height: 1.8;
    margin: 0 0 1rem;
    opacity: 0.6;
    transition: opacity 0.3s, color 0.3s;
  }

  .ladder-cta {
    display: inline-block;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--accent-dark);
    letter-spacing: 0.02em;
    text-decoration: none;
    opacity: 0;
    transition: opacity 0.3s, color 0.2s;
  }
  .ladder-cta:hover {
    color: var(--accent);
  }

  /* ── Active states ── */
  .ladder-tier.active .ladder-letter {
    color: var(--accent-dark);
    border-color: var(--accent-dark);
  }

  .ladder-tier.active .ladder-left h3 {
    color: var(--text-heading);
  }

  .ladder-tier.active .ladder-badge {
    color: var(--accent-dark);
    border-color: rgba(196, 155, 104, 0.3);
    background: rgba(196, 155, 104, 0.08);
  }

  .ladder-tier.active .ladder-summary {
    color: var(--text-heading);
  }

  .ladder-tier.active .ladder-detail {
    opacity: 1;
  }

  .ladder-tier.active .ladder-cta {
    opacity: 1;
  }

  /* ── Spark burst on activation ── */
  .ladder-letter .spark {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 4px;
    height: 4px;
    margin: -2px 0 0 -2px;
    border-radius: 50%;
    background: var(--accent-dark);
    opacity: 0;
    pointer-events: none;
    z-index: 10;
  }

  .ladder-letter .spark.fire {
    animation: ladderSparkBurst 0.7s ease-out forwards;
  }

  @keyframes ladderSparkBurst {
    0% { opacity: 1; transform: translate(0, 0) scale(1.2); }
    40% { opacity: 0.9; }
    100% { opacity: 0; transform: var(--spark-dir) scale(0); }
  }


  /* ═══════════ DIVISIONS ═══════════ */
  .divisions-section {
    padding: 4.5rem 0;
    border-bottom: 1px solid var(--border-light);
  }

  .divisions-inner {
    max-width: 100%;
  }

  .divisions-eyebrow {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: rgba(196, 110, 66, 0.7);
    margin-bottom: 0.75rem;
  }

  .edu-page .divisions-heading {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2.5rem;
    font-weight: 400;
    color: var(--text-heading);
    letter-spacing: -0.01em;
    margin: 0 0 1rem;
  }

  .divisions-intro {
    font-size: 0.9375rem;
    color: var(--text-secondary);
    line-height: 1.75;
    max-width: 620px;
    margin-bottom: 2.5rem;
  }

  .divisions-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 0 2rem;
  }

  .division-card {
    display: block;
    padding: 1.75rem 0;
    background: none;
    border: none;
    border-top: 1px solid var(--border-light);
    border-radius: 0;
    text-decoration: none;
    transition: opacity 0.2s;
  }

  .division-card:hover {
    opacity: 0.8;
  }

  .division-dot {
    display: block;
    width: 8px;
    height: 8px;
    border-radius: 50%;
    margin-bottom: 1rem;
  }

  [data-accent="terracotta"] .division-dot { background: var(--accent-dark); }
  [data-accent="warm"] .division-dot { background: var(--chart-warm); }
  [data-accent="blue"] .division-dot { background: var(--chart-blue); }
  [data-accent="teal"] .division-dot { background: var(--chart-teal); }
  [data-accent="purple"] .division-dot { background: var(--chart-purple); }

  .division-num {
    display: block;
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.5rem;
    color: var(--text-heading);
    opacity: 0.35;
    line-height: 1;
    margin-bottom: 0.75rem;
  }

  .division-card h3 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.1rem;
    font-weight: 500;
    color: var(--text-heading);
    line-height: 1.3;
    margin-bottom: 0.75rem;
  }

  .division-card p {
    font-size: 0.75rem;
    color: var(--text-body-60);
    line-height: 1.65;
    margin-bottom: 0;
  }


  /* ═══════════ CTA ═══════════ */
  .cta-section {
    margin: 0 -40px;
    padding: 0;
    background: #141210;
    border-bottom: none;
  }

  .cta-inner {
    max-width: 640px;
    margin: 0 auto;
    padding: 6rem 2rem;
    text-align: center;
  }

  .cta-eyebrow {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.14em;
    color: rgba(196, 110, 66, 0.7);
    margin-bottom: 1rem;
  }

  .cta-primary-block h2 {
    font-family: 'Cormorant Garamond', serif;
    font-size: 3rem;
    font-weight: 400;
    color: #e8dfd0;
    letter-spacing: -0.01em;
    margin: 0 0 1.25rem;
  }

  .cta-primary-block p {
    font-size: 1rem;
    color: rgba(208, 200, 188, 0.55);
    line-height: 1.7;
    max-width: 440px;
    margin: 0 auto 2.5rem;
  }

  .cta-primary-btn {
    display: inline-block;
    padding: 14px 40px;
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-weight: 600;
    letter-spacing: 0.03em;
    color: #141210;
    background: var(--accent-dark);
    border: none;
    border-radius: 4px;
    text-decoration: none;
    transition: background 0.2s, transform 0.15s;
  }

  .cta-primary-btn:hover {
    background: #d4773a;
    transform: translateY(-1px);
  }

  .cta-secondary-block {
    display: flex;
    justify-content: center;
    gap: 3rem;
    margin-top: 3rem;
    padding-top: 2.5rem;
    border-top: 1px solid rgba(255, 255, 255, 0.06);
  }

  .cta-alt {
    text-decoration: none;
    text-align: center;
  }

  .cta-alt-label {
    display: block;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: rgba(208, 200, 188, 0.35);
    margin-bottom: 0.375rem;
  }

  .cta-alt-action {
    display: block;
    font-size: 0.8125rem;
    color: rgba(208, 200, 188, 0.6);
    transition: color 0.2s;
  }

  .cta-alt:hover .cta-alt-action {
    color: #e8dfd0;
  }


  /* ═══════════ RESPONSIVE ═══════════ */
  @media (max-width: 1024px) {
    .edu-hero {
      margin: 0 -20px;
    }

    .hero-inner {
      padding: 64px calc(1.5rem + 20px) 48px calc(1rem + 20px);
    }

    .divisions-grid { grid-template-columns: repeat(3, 1fr); }

    .cta-section { margin: 0 -20px; }
  }

  @media (max-width: 768px) {
    .hero-inner {
      padding: 48px 1.25rem 36px;
    }

    .hero-title { font-size: 2.5rem; }
    .hero-subtitle { font-size: 2rem; }
    .hero-lead { padding-left: 0; }

    .ladder-tier {
      grid-template-columns: 1fr;
      gap: 1.5rem;
      padding: 4rem 0;
    }
    .ladder-left {
      flex-direction: row;
      align-items: center;
      gap: 1rem;
    }
    .ladder-letter { margin-bottom: 0; }
    .ladder-left h3 { margin: 0; }
    .ladder-track { display: none; }
    .ladder-right { max-width: none; }

    .pillars-grid { grid-template-columns: 1fr; }
    .divisions-grid { grid-template-columns: 1fr 1fr; }

    .cta-secondary-block { flex-direction: column; gap: 1.5rem; }
  }

  @media (max-width: 480px) {
    .divisions-grid { grid-template-columns: 1fr; }
  }
</style>

<script>
  function initLadderProgress() {
    const section = document.querySelector('.ladder-section') as HTMLElement
    const ladder = document.querySelector('.ladder') as HTMLElement
    const trackFill = ladder?.querySelector('.track-fill') as HTMLElement
    const tiers = ladder?.querySelectorAll('.ladder-tier') as NodeListOf<HTMLElement>
    if (!section || !ladder || !trackFill || !tiers.length) return

    const activated = new Set<number>()

    function emitSparks(letter: HTMLElement) {
      for (let i = 0; i < 8; i++) {
        const spark = document.createElement('span')
        spark.className = 'spark'
        const angle = (i / 8) * Math.PI * 2
        const dist = 28 + Math.random() * 10
        const tx = Math.cos(angle) * dist
        const ty = Math.sin(angle) * dist
        spark.style.setProperty('--spark-dir', `translate(${tx}px, ${ty}px)`)
        letter.appendChild(spark)
        requestAnimationFrame(() => spark.classList.add('fire'))
        setTimeout(() => spark.remove(), 800)
      }
    }

    function update() {
      const sectionRect = section.getBoundingClientRect()
      const viewH = window.innerHeight

      // Progress bar fill
      const scrollStart = sectionRect.top + viewH * 0.15
      const scrollEnd = sectionRect.bottom - viewH * 0.3
      const scrollRange = scrollEnd - scrollStart
      const scrolled = -scrollStart
      const progress = Math.max(0, Math.min(1, scrolled / scrollRange))

      const trackEl = ladder.querySelector('.ladder-track') as HTMLElement
      if (trackEl) {
        const trackRect = trackEl.getBoundingClientRect()
        trackFill.style.height = (trackRect.height * progress) + 'px'
      }

      // Tier activation
      tiers.forEach((tier, idx) => {
        const rect = tier.getBoundingClientRect()
        const tierCenter = rect.top + rect.height * 0.4
        const trigger = viewH * 0.55
        const isActive = tierCenter < trigger && rect.bottom > 0

        if (isActive) {
          tier.classList.add('active')
          const right = tier.querySelector('.ladder-right')
          if (right) right.classList.add('visible')

          if (!activated.has(idx)) {
            activated.add(idx)
            const letter = tier.querySelector('.ladder-letter')
            if (letter) emitSparks(letter as HTMLElement)
          }
        } else {
          tier.classList.remove('active')
        }
      })
    }

    window.addEventListener('scroll', update, { passive: true })
    window.addEventListener('resize', update, { passive: true })
    update()
  }

  document.addEventListener('DOMContentLoaded', initLadderProgress)
  document.addEventListener('astro:page-load', initLadderProgress)
</script>
