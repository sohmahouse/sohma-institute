---
import PortalLayout from '../layouts/PortalLayout.astro'
import { articles, getArticlesByCategory } from '../data/articles'

const groups = getArticlesByCategory()
const totalArticles = articles.length
const totalCategories = groups.length
---

<PortalLayout title="Clinical Knowledge Base — Sohma Institute" description="Evidence-informed clinical education for cannabis medicine practitioners.">
  <div class="kb">
    <div class="kb-inner">

      <!-- Masthead -->
      <header class="kb-masthead">
        <h1 class="kb-title">Clinical Knowledge Base</h1>
        <p class="kb-lead">
          Evidence-informed clinical education for cannabis medicine practitioners.
          Peer-reviewed research syntheses, clinical protocols, and reference material
          developed for Sohma Institute clinicians.
        </p>
        <div class="kb-stats">
          <span>{totalArticles} articles</span>
          <span class="kb-stats-sep" aria-hidden="true"></span>
          <span>{totalCategories} disciplines</span>
        </div>
      </header>

      <!-- Category Sections -->
      {groups.map((group, i) => (
        <section class="kb-section">
          <div class="kb-section-header">
            <h2 class="kb-section-title">{group.category}</h2>
            <span class="kb-section-count">{group.articles.length} {group.articles.length === 1 ? 'article' : 'articles'}</span>
          </div>

          <ol class="kb-listing">
            {group.articles.map(article => (
              <li>
                <a href={`/${article.slug}`} class="kb-entry">
                  <div class="kb-entry-main">
                    <h3 class="kb-entry-title">{article.title}</h3>
                    <p class="kb-entry-subtitle">{article.subtitle}</p>
                    <p class="kb-entry-summary">{article.summary}</p>
                    <div class="kb-entry-meta">
                      <span class="kb-entry-author">{article.author}</span>
                      <span class="kb-entry-role">{article.authorRole}</span>
                    </div>
                  </div>
                  {article.readingTime && (
                    <span class="kb-entry-time">{article.readingTime}</span>
                  )}
                </a>
              </li>
            ))}
          </ol>
        </section>
      ))}

      <!-- Colophon -->
      <footer class="kb-footer">
        <p>Sohma Institute &mdash; Clinical Education Division</p>
      </footer>
    </div>
  </div>
</PortalLayout>

<style>
  .kb {
    min-height: 100vh;
    padding: 3rem 2.5rem 2rem;
  }

  .kb-inner {
    max-width: 780px;
    margin: 0 auto;
  }

  /* ── Masthead ── */
  .kb-masthead {
    padding-bottom: 2rem;
    margin-bottom: 0.5rem;
    border-bottom: 1px solid #d6d0ca;
  }

  .kb-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 2rem;
    font-weight: 600;
    color: #2c2520;
    line-height: 1.2;
    margin: 0 0 0.75rem;
    letter-spacing: -0.01em;
  }

  .kb-lead {
    font-family: 'Manrope', sans-serif;
    font-size: 0.9375rem;
    color: #6b5e52;
    line-height: 1.65;
    margin: 0 0 1rem;
    max-width: 600px;
  }

  .kb-stats {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-family: 'Manrope', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    color: #a89e94;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .kb-stats-sep {
    width: 3px;
    height: 3px;
    border-radius: 50%;
    background: #c9c1b8;
  }

  /* ── Category Sections ── */
  .kb-section {
    padding: 2rem 0 0.5rem;
  }

  .kb-section-header {
    display: flex;
    align-items: baseline;
    gap: 0.75rem;
    padding-bottom: 0.625rem;
    border-bottom: 1px solid #e2ded9;
    margin-bottom: 0;
  }

  .kb-section-title {
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #2c2520;
    margin: 0;
  }

  .kb-section-count {
    font-family: 'Manrope', sans-serif;
    font-size: 0.625rem;
    font-weight: 500;
    color: #b8afa7;
    letter-spacing: 0.02em;
  }

  /* ── Article Listing ── */
  .kb-listing {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .kb-listing li {
    border-bottom: 1px solid #ece9e5;
  }

  .kb-listing li:last-child {
    border-bottom: none;
  }

  .kb-entry {
    display: flex;
    align-items: flex-start;
    gap: 1.5rem;
    padding: 1.125rem 0;
    text-decoration: none;
    transition: background 0.15s;
    margin: 0 -0.75rem;
    padding-left: 0.75rem;
    padding-right: 0.75rem;
    border-radius: 4px;
  }

  .kb-entry:hover {
    background: rgba(196, 90, 66, 0.03);
  }

  .kb-entry-main {
    flex: 1;
    min-width: 0;
  }

  .kb-entry-title {
    font-family: 'Cormorant Garamond', serif;
    font-size: 1.25rem;
    font-weight: 600;
    color: #2c2520;
    line-height: 1.3;
    margin: 0 0 0.2rem;
    transition: color 0.15s;
  }

  .kb-entry:hover .kb-entry-title {
    color: #c45a42;
  }

  .kb-entry-subtitle {
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    font-style: italic;
    color: #8a7e74;
    line-height: 1.45;
    margin: 0 0 0.5rem;
  }

  .kb-entry-summary {
    font-family: 'Manrope', sans-serif;
    font-size: 0.8125rem;
    color: #7a6e63;
    line-height: 1.55;
    margin: 0 0 0.5rem;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .kb-entry-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    flex-wrap: wrap;
  }

  .kb-entry-author {
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 600;
    color: #6b5e52;
  }

  .kb-entry-role {
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    color: #a89e94;
  }

  .kb-entry-role::before {
    content: '\2014\00a0';
  }

  .kb-entry-time {
    flex-shrink: 0;
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 500;
    color: #b8afa7;
    white-space: nowrap;
    padding-top: 0.125rem;
  }

  /* ── Footer ── */
  .kb-footer {
    margin-top: 2.5rem;
    padding-top: 1.25rem;
    border-top: 1px solid #d6d0ca;
  }

  .kb-footer p {
    font-family: 'Manrope', sans-serif;
    font-size: 0.6875rem;
    font-weight: 500;
    color: #b8afa7;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    margin: 0;
  }

  /* ── Responsive ── */
  @media (max-width: 640px) {
    .kb {
      padding: 2rem 1.25rem 1.5rem;
    }

    .kb-title {
      font-size: 1.625rem;
    }

    .kb-entry {
      flex-direction: column;
      gap: 0.25rem;
    }

    .kb-entry-time {
      padding-top: 0;
    }

    .kb-entry-title {
      font-size: 1.125rem;
    }
  }
</style>
