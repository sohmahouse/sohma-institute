---
import PortalLayout from './PortalLayout.astro'
import { articles, categoryMeta } from '../data/articles'
import '../styles/article.css'

interface TocItem {
  id: string
  label: string
  level: number
}

interface Props {
  slug: string
  toc: TocItem[]
}

const { slug, toc } = Astro.props
const article = articles.find(a => a.slug === slug)!
const category = categoryMeta.find(c => c.name === article.category)!
---

<PortalLayout
  title={article.title}
  description={article.subtitle}
  toc={toc}
  activeArticle={slug}
>
  <article
    class="whitepaper"
    data-subtitle={article.subtitle}
    data-category={article.category}
    data-date={article.date}
    data-reading-time={article.readingTime || ''}
    data-summary={article.summary}
    data-editor={article.editor || ''}
    data-editor-role={article.editorRole || ''}
  >
    <header class="wp-header">
      <div class="wp-hero-content">
        <nav class="wp-breadcrumbs">
          <a href="/">Home</a>
          <span class="wp-breadcrumb-sep">|</span>
          <a href={`/whitepapers#${category.slug}`}>{category.name}</a>
        </nav>
        <h1 class="wp-title">{article.title}</h1>
        <div class="wp-date-line">
          <span>{article.date}</span>
          {article.readingTime && (
            <span class="wp-date-sep">|</span>
            <span>{article.readingTime} read</span>
          )}
        </div>
        <p class="wp-excerpt">{article.summary}</p>

        <!-- Print-only author block (hidden on screen) -->
        <div class="wp-print-author">
          <p class="wp-print-author-name">{article.author}</p>
          <p class="wp-print-author-role">{article.authorRole}</p>
          <p class="wp-print-author-institution">Sohma Institute of Traditional Medicines, Cairns QLD</p>
          {article.editor && (
            <p class="wp-print-editor">Editor: {article.editor}{article.editorRole ? `, ${article.editorRole}` : ''}</p>
          )}
          <p class="wp-print-meta">{article.date}{article.readingTime ? `  |  ${article.category}  |  ${article.readingTime} read` : `  |  ${article.category}`}</p>
        </div>

        <div class="wp-meta-row">
          <div class="wp-credits wp-credits-right">
            <div class="wp-credit">
              <span class="wp-credit-function">Author</span>
              <span class="wp-credit-name">{article.author}</span>
              <span class="wp-credit-title">{article.authorRole}</span>
            </div>
            {article.editor && (
              <div class="wp-credit">
                <span class="wp-credit-function">Editor</span>
                <span class="wp-credit-name">{article.editor}</span>
                {article.editorRole && <span class="wp-credit-title">{article.editorRole}</span>}
              </div>
            )}
          </div>
        </div>
      </div>
    </header>

    <div class="wp-body">
      <div class="wp-body-fade" aria-hidden="true"></div>
      <slot />
    </div>
  </article>
</PortalLayout>
